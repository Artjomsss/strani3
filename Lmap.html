<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        /* ... (–≤—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
    </style>
</head>
<body>
    <!-- ... (HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->

    <script>
        // ... (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase, —Ü–≤–µ—Ç–∞ —Å—Ç—Ä–∞–Ω, –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω - –§–∏–Ω–ª—è–Ω–¥–∏—è –∏ –ü—Ä–∏–±–∞–ª—Ç–∏–∫–∞ –ø–æ–¥–Ω—è—Ç—ã –Ω–∞ 5 –∫–ª–µ—Ç–æ–∫ –≤–≤–µ—Ä—Ö
        const countryPixels = {
            // ... (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        };

        // –ò–≥—Ä–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        const gameState = {
            playerId: 'player_latvia',
            units: [],
            territories: {},
            selectedUnit: null,
            ghostUnit: null,
            radialMenu: {
                active: false,
                unit: null
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        function getExactCoordinates(e) {
            const pixelMap = document.getElementById('pixel-map');
            const rect = pixelMap.getBoundingClientRect();
            
            // –í–°–ï –û–¢–°–¢–£–ü–´ –ò –ì–†–ê–ù–ò–¶–´ –ö–û–ù–¢–ï–ô–ù–ï–†–ê
            const containerStyles = window.getComputedStyle(pixelMap);
            const paddingLeft = parseFloat(containerStyles.paddingLeft);
            const paddingTop = parseFloat(containerStyles.paddingTop);
            const borderLeft = parseFloat(containerStyles.borderLeftWidth);
            const borderTop = parseFloat(containerStyles.borderTopWidth);
            
            // –†–ê–°–ß–ï–¢ –° –£–ß–ï–¢–û–ú –í–°–ï–• –û–¢–°–¢–£–ü–û–í
            const totalOffsetX = paddingLeft + borderLeft;
            const totalOffsetY = paddingTop + borderTop;
            
            const relativeX = e.clientX - rect.left - totalOffsetX;
            const relativeY = e.clientY - rect.top - totalOffsetY;
            
            const x = Math.floor(relativeX / 25);
            const y = Math.floor(relativeY / 25);
            
            console.log('üîç –¢–û–ß–ù–´–ï –ö–û–û–†–î–ò–ù–ê–¢–´:', {
                clientX: e.clientX,
                clientY: e.clientY,
                rectLeft: rect.left,
                rectTop: rect.top,
                paddingLeft,
                paddingTop,
                borderLeft,
                borderTop,
                totalOffsetX,
                totalOffsetY,
                relativeX,
                relativeY,
                finalX: x,
                finalY: y
            });
            
            return { x, y };
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–¥–∏–∞–ª—å–Ω—ã–º –º–µ–Ω—é
        function createRadialMenu(unit, x, y) {
            const radialMenu = document.getElementById('radial-menu');
            radialMenu.innerHTML = '<div class="radial-menu-center">‚öôÔ∏è</div>';
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –º–µ–Ω—é —Å —É—á–µ—Ç–æ–º —Ç–æ—á–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            const pixelMap = document.getElementById('pixel-map');
            const rect = pixelMap.getBoundingClientRect();
            const containerStyles = window.getComputedStyle(pixelMap);
            const paddingLeft = parseFloat(containerStyles.paddingLeft);
            const paddingTop = parseFloat(containerStyles.paddingTop);
            const borderLeft = parseFloat(containerStyles.borderLeftWidth);
            const borderTop = parseFloat(containerStyles.borderTopWidth);
            
            const totalOffsetX = paddingLeft + borderLeft;
            const totalOffsetY = paddingTop + borderTop;
            
            const pixelLeft = x * 25 + totalOffsetX;
            const pixelTop = y * 25 + totalOffsetY;
            const centerOffset = (25 - 20) / 2;
            
            radialMenu.style.left = (pixelLeft + centerOffset - 30) + 'px';
            radialMenu.style.top = (pixelTop + centerOffset - 30) + 'px';
            
            // ... (—Å–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–Ω—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function closeRadialMenu() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function handleMenuAction(action, unit) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function startDragMode(unit) {
            if (unit.isMoving) {
                alert('–ê—Ä–º–∏—è —É–∂–µ –≤ –¥–≤–∏–∂–µ–Ω–∏–∏!');
                return;
            }
            
            gameState.selectedUnit = unit;
            createGhostUnit(unit);
            
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.classList.add('dragging');
            }
            
            // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            document.addEventListener('mousemove', dragUnit);
            document.addEventListener('mouseup', endDragUnit);
            
            alert('–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—Ä–º–∏—é –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ');
        }

        function dragUnit(e) {
            if (!gameState.ghostUnit || !gameState.selectedUnit) return;
            
            const { x, y } = getExactCoordinates(e);
            
            if (x >= 0 && x < 50 && y >= 0 && y < 35) {
                updateGhostPosition(x, y);
                showMovementPath(gameState.selectedUnit.position, {x, y});
            }
        }

        function endDragUnit(e) {
            if (gameState.ghostUnit && gameState.selectedUnit) {
                const { x, y } = getExactCoordinates(e);
                
                console.log('üéØ –§–ò–ù–ê–õ–¨–ù–´–ï –ö–û–û–†–î–ò–ù–ê–¢–´ –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–Ø:', {x, y});
                
                if (x >= 0 && x < 50 && y >= 0 && y < 35) {
                    if (x !== gameState.selectedUnit.position.x || y !== gameState.selectedUnit.position.y) {
                        moveUnit(gameState.selectedUnit, {x, y});
                    }
                }
            }
            
            cleanupDrag();
            document.removeEventListener('mousemove', dragUnit);
            document.removeEventListener('mouseup', endDragUnit);
        }

        // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ deleteUnit, showUnitInfo, splitUnit, upgradeUnit –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        function saveToDatabase(path, data) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function loadFromDatabase(path, callback) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä–º–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
        function createArmy(size) {
            const unit = {
                id: 'unit_' + Date.now(),
                type: 'soldier',
                owner: gameState.playerId,
                position: { x: 28, y: 9 },
                size: size,
                isMoving: false
            };

            gameState.units.push(unit);
            renderUnit(unit);
            setupUnitClick(unit);
            updateGameStats();
            
            saveToDatabase('units/' + unit.id, unit);
            
            console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∞—Ä–º–∏—è –≤ –õ–∞—Ç–≤–∏–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ ${unit.position.x},${unit.position.y}`);
            
            // –û–¢–õ–ê–î–ö–ê: –ø–æ–∫–∞–∂–µ–º –≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —é–Ω–∏—Ç
            setTimeout(() => {
                const unitElement = document.getElementById(unit.id);
                if (unitElement) {
                    const rect = unitElement.getBoundingClientRect();
                    const pixelMap = document.getElementById('pixel-map');
                    const mapRect = pixelMap.getBoundingClientRect();
                    
                    console.log('üîç –†–ï–ê–õ–¨–ù–û–ï –ü–û–õ–û–ñ–ï–ù–ò–ï –Æ–ù–ò–¢–ê:', {
                        unitPosition: unit.position,
                        elementLeft: rect.left,
                        elementTop: rect.top,
                        mapLeft: mapRect.left,
                        mapTop: mapRect.top,
                        offsetX: rect.left - mapRect.left,
                        offsetY: rect.top - mapRect.top
                    });
                }
            }, 100);
        }

        function createCustomArmy() {
            const size = parseInt(document.getElementById('army-size').value) || 100;
            createArmy(size);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —é–Ω–∏—Ç—É
        function setupUnitClick(unit) {
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!gameState.radialMenu.active) {
                        const x = unit.position.x;
                        const y = unit.position.y;
                        createRadialMenu(unit, x, y);
                    }
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —é–Ω–∏—Ç
        function debugUnitPosition(unit) {
            const country = findCountryForPixel(unit.position.x, unit.position.y);
            console.log(`üîç –ê—Ä–º–∏—è ${unit.id} –Ω–∞ ${unit.position.x},${unit.position.y} - —Å—Ç—Ä–∞–Ω–∞: ${country || '–ú–û–†–ï/–ù–ï–¢'}`);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ–π
        function generateRectangle(startX, startY, width, height) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function createPixelMap() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function findCountryForPixel(x, y) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function getCountryCode(countryId) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function addCountryBorders() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function isValidCoordinate(x, y) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function updateStatistics() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function createCountryList() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function handlePixelHover(event) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function handlePixelLeave(event) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —é–Ω–∏—Ç–∞–º–∏
        function renderUnit(unit) {
            let unitElement = document.getElementById(unit.id);
            if (!unitElement) {
                unitElement = document.createElement('div');
                unitElement.id = unit.id;
                document.getElementById('pixel-map').appendChild(unitElement);
            }
            
            unitElement.className = `unit soldier ${unit.isMoving ? 'moving' : ''}`;
            
            // –¢–æ—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–∏–∫—Å–µ–ª—è —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –æ—Ç—Å—Ç—É–ø–æ–≤
            const pixelMap = document.getElementById('pixel-map');
            const containerStyles = window.getComputedStyle(pixelMap);
            const paddingLeft = parseFloat(containerStyles.paddingLeft);
            const paddingTop = parseFloat(containerStyles.paddingTop);
            const borderLeft = parseFloat(containerStyles.borderLeftWidth);
            const borderTop = parseFloat(containerStyles.borderTopWidth);
            
            const totalOffsetX = paddingLeft + borderLeft;
            const totalOffsetY = paddingTop + borderTop;
            
            const pixelLeft = unit.position.x * 25 + totalOffsetX;
            const pixelTop = unit.position.y * 25 + totalOffsetY;
            const centerOffset = (25 - 20) / 2;
            
            unitElement.style.left = (pixelLeft + centerOffset) + 'px';
            unitElement.style.top = (pixelTop + centerOffset) + 'px';
            unitElement.style.background = '#3498db';
            unitElement.innerHTML = `üë•<div style="font-size:8px">${unit.size}</div>`;
            
            debugUnitPosition(unit);
        }

        function createGhostUnit(unit) {
            const pixelMap = document.getElementById('pixel-map');
            const ghost = document.createElement('div');
            
            ghost.className = `unit soldier ghost`;
            
            const containerStyles = window.getComputedStyle(pixelMap);
            const paddingLeft = parseFloat(containerStyles.paddingLeft);
            const paddingTop = parseFloat(containerStyles.paddingTop);
            const borderLeft = parseFloat(containerStyles.borderLeftWidth);
            const borderTop = parseFloat(containerStyles.borderTopWidth);
            
            const totalOffsetX = paddingLeft + borderLeft;
            const totalOffsetY = paddingTop + borderTop;
            
            const pixelLeft = unit.position.x * 25 + totalOffsetX;
            const pixelTop = unit.position.y * 25 + totalOffsetY;
            const centerOffset = (25 - 20) / 2;
            
            ghost.style.left = (pixelLeft + centerOffset) + 'px';
            ghost.style.top = (pixelTop + centerOffset) + 'px';
            ghost.style.background = '#3498db';
            ghost.innerHTML = `üë•<div style="font-size:8px">${unit.size}</div>`;
            
            pixelMap.appendChild(ghost);
            gameState.ghostUnit = ghost;
        }

        function updateGhostPosition(x, y) {
            if (gameState.ghostUnit) {
                const pixelMap = document.getElementById('pixel-map');
                const containerStyles = window.getComputedStyle(pixelMap);
                const paddingLeft = parseFloat(containerStyles.paddingLeft);
                const paddingTop = parseFloat(containerStyles.paddingTop);
                const borderLeft = parseFloat(containerStyles.borderLeftWidth);
                const borderTop = parseFloat(containerStyles.borderTopWidth);
                
                const totalOffsetX = paddingLeft + borderLeft;
                const totalOffsetY = paddingTop + borderTop;
                
                const pixelLeft = x * 25 + totalOffsetX;
                const pixelTop = y * 25 + totalOffsetY;
                const centerOffset = (25 - 20) / 2;
                
                gameState.ghostUnit.style.left = (pixelLeft + centerOffset) + 'px';
                gameState.ghostUnit.style.top = (pixelTop + centerOffset) + 'px';
            }
        }

        function showMovementPath(start, end) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function calculateMoveDuration(distance, speedMultiplier) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function formatDuration(seconds) {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function moveUnit(unit, targetPos) {
            console.log('moveUnit –í–•–û–î:', {targetPos});
            console.log('–¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è unit:', unit.position);
            
            if (unit.position.x === targetPos.x && unit.position.y === targetPos.y) {
                console.log('–û–®–ò–ë–ö–ê: –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä–∞–≤–Ω–∞ —Ç–µ–∫—É—â–µ–π');
                return;
            }
            
            const distance = Math.sqrt(Math.pow(targetPos.x - unit.position.x, 2) + Math.pow(targetPos.y - unit.position.y, 2));
            const isCountry = findCountryForPixel(targetPos.x, targetPos.y) !== null;
            const speedMultiplier = isCountry ? 1.0 : 0.5;
            const duration = calculateMoveDuration(distance, speedMultiplier);
            
            unit.isMoving = true;
            unit.targetPosition = targetPos;
            unit.moveStartTime = Date.now();
            unit.moveDuration = duration * 1000;
            
            console.log(`–ê—Ä–º–∏—è ${unit.id} –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ –∏–∑ ${unit.position.x},${unit.position.y} –≤ ${targetPos.x},${targetPos.y} –∑–∞ ${duration}—Å–µ–∫`);
            
            saveToDatabase('units/' + unit.id, unit);
            
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.classList.add('moving');
            }
            
            startMovementAnimation(unit);
        }

        function startMovementAnimation(unit) {
            const unitElement = document.getElementById(unit.id);
            if (!unitElement) return;
            
            const startTime = Date.now();
            const startPos = {...unit.position};
            const targetPos = unit.targetPosition;
            
            const pixelMap = document.getElementById('pixel-map');
            const containerStyles = window.getComputedStyle(pixelMap);
            const paddingLeft = parseFloat(containerStyles.paddingLeft);
            const paddingTop = parseFloat(containerStyles.paddingTop);
            const borderLeft = parseFloat(containerStyles.borderLeftWidth);
            const borderTop = parseFloat(containerStyles.borderTopWidth);
            
            const totalOffsetX = paddingLeft + borderLeft;
            const totalOffsetY = paddingTop + borderTop;
            const centerOffset = (25 - 20) / 2;
            
            function animateMove() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / unit.moveDuration, 1);
                
                if (progress < 1) {
                    const currentX = startPos.x + (targetPos.x - startPos.x) * progress;
                    const currentY = startPos.y + (targetPos.y - startPos.y) * progress;
                    
                    const pixelLeft = currentX * 25 + totalOffsetX;
                    const pixelTop = currentY * 25 + totalOffsetY;
                    
                    unitElement.style.left = (pixelLeft + centerOffset) + 'px';
                    unitElement.style.top = (pixelTop + centerOffset) + 'px';
                    
                    requestAnimationFrame(animateMove);
                } else {
                    unit.isMoving = false;
                    unit.position = targetPos;
                    unit.targetPosition = null;
                    
                    if (unitElement) {
                        unitElement.classList.remove('moving');
                        const finalPixelLeft = targetPos.x * 25 + totalOffsetX;
                        const finalPixelTop = targetPos.y * 25 + totalOffsetY;
                        unitElement.style.left = (finalPixelLeft + centerOffset) + 'px';
                        unitElement.style.top = (finalPixelTop + centerOffset) + 'px';
                    }
                    
                    checkForCapture(unit);
                    updateGameStats();
                    saveToDatabase('units/' + unit.id, unit);
                    
                    console.log(`‚úÖ –ê—Ä–º–∏—è ${unit.id} –ø—Ä–∏–±—ã–ª–∞ –≤ ${targetPos.x},${targetPos.y}`);
                }
            }
            
            animateMove();
        }

        function checkForCapture(unit) {
            const country = findCountryForPixel(unit.position.x, unit.position.y);
            console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞: –∞—Ä–º–∏—è –Ω–∞ ${unit.position.x},${unit.position.y}, —Å—Ç—Ä–∞–Ω–∞: ${country}`);
            
            if (country && country !== 'latvia') {
                const territoryKey = `${unit.position.x},${unit.position.y}`;
                gameState.territories[territoryKey] = {
                    originalCountry: country,
                    capturedBy: unit.owner,
                    unitId: unit.id,
                    timestamp: Date.now()
                };

                const pixel = document.querySelector(`.pixel[data-x="${unit.position.x}"][data-y="${unit.position.y}"]`);
                if (pixel) {
                    pixel.classList.add('captured-territory');
                    pixel.title = `–ó–∞—Ö–≤–∞—á–µ–Ω–æ –õ–∞—Ç–≤–∏–µ–π\n–ê—Ä–º–∏—è: ${unit.size} —Å–æ–ª–¥–∞—Ç`;
                    console.log(`‚úÖ –ó–∞—Ö–≤–∞—á–µ–Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è ${territoryKey} —É ${country}`);
                }

                updateGameStats();
                saveToDatabase('territories/' + territoryKey, gameState.territories[territoryKey]);
            }
        }

        function cleanupDrag() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function updateGameStats() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        function loadGameData() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        function updateCapturedTerritories() {
            // ... (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initialize() {
            createPixelMap();
            loadGameData();
            
            setTimeout(() => {
                if (gameState.units.length === 0) {
                    createArmy(500);
                    createArmy(1000);
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', initialize);

        document.getElementById('pixel-map').addEventListener('click', (e) => {
            if (gameState.radialMenu.active && !e.target.closest('.radial-menu')) {
                closeRadialMenu();
            }
        });

        // –î–û–ë–ê–í–ò–ú –û–¢–õ–ê–î–ö–£ –ö–õ–ò–ö–û–í –ü–û –ö–ê–†–¢–ï
        document.getElementById('pixel-map').addEventListener('click', (e) => {
            if (e.target.classList.contains('pixel')) {
                const x = parseInt(e.target.dataset.x);
                const y = parseInt(e.target.dataset.y);
                const country = e.target.dataset.country;
                console.log('üéØ –ö–õ–ò–ö –ü–û –ü–ò–ö–°–ï–õ–Æ:', {x, y, country});
            }
        });
    </script>
</body>
</html>

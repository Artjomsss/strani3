<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã - –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c0c1a, #1a1a2e);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.25), rgba(39, 174, 96, 0.2));
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.15);
        }

        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2ecc71, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .map-container {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .pixel-map {
            display: grid;
            grid-template-columns: repeat(50, 25px);
            grid-template-rows: repeat(35, 25px);
            gap: 1px;
            background: #2a2a40;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #3a3a5a;
            position: relative;
            margin: 0 auto;
            max-width: fit-content;
        }

        .pixel {
            width: 25px;
            height: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            border: 1px solid rgba(0,0,0,0.3);
            user-select: none;
        }

        .pixel:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 0 2px #f39c12, 0 0 15px rgba(243, 156, 18, 0.5);
        }

        .pixel.empty {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .pixel.latvia {
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .country-border {
            position: absolute;
            background: rgba(0,0,0,0.9);
            z-index: 5;
            pointer-events: none;
        }

        .border-top { top: -1px; left: 0; width: 100%; height: 1px; }
        .border-right { top: 0; right: -1px; width: 1px; height: 100%; }
        .border-bottom { bottom: -1px; left: 0; width: 100%; height: 1px; }
        .border-left { top: 0; left: -1px; width: 1px; height: 100%; }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .control-group {
            margin-bottom: 25px;
        }

        h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h3 {
            color: #2ecc71;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .legend {
            display: grid;
            grid-template-columns: 20px 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .status-info {
            background: rgba(52, 152, 219, 0.15);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .region-details {
            background: rgba(39, 174, 96, 0.15);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #27ae60;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-label {
            font-weight: bold;
            color: #bdc3c7;
        }

        .detail-value {
            color: #ecf0f1;
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255,255,255,0.08);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .country-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #3498db;
        }

        .coordinates {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .back-btn {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: linear-gradient(145deg, #2980b9, #21618c);
            transform: translateY(-2px);
        }

        .country-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .country-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .player-name {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        .game-system {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            margin-top: 20px;
        }

        .unit-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .unit-btn {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .unit-btn:hover {
            background: linear-gradient(145deg, #2980b9, #21618c);
            transform: translateY(-2px);
        }

        .unit-btn.attack {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
        }

        .unit-btn.attack:hover {
            background: linear-gradient(145deg, #c0392b, #a93226);
        }

        .unit-info {
            background: rgba(52, 152, 219, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }

        .unit {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            z-index: 20;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            cursor: grab;
            transition: all 0.3s ease;
            pointer-events: auto;
        }

        .unit.dragging {
            opacity: 0.7;
            transform: scale(1.3);
            z-index: 100;
            cursor: grabbing;
        }

        .unit.ghost {
            opacity: 0.4;
            z-index: 90;
            pointer-events: none;
        }

        .unit.soldier {
            background: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
        }

        .unit.tank {
            background: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.7);
        }

        .unit.moving {
            animation: pulseMove 2s infinite;
        }

        @keyframes pulseMove {
            0% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor; }
            100% { box-shadow: 0 0 5px currentColor; }
        }

        .movement-path {
            position: absolute;
            background: rgba(52, 152, 219, 0.3);
            border-radius: 2px;
            z-index: 10;
            pointer-events: none;
        }

        .movement-time {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            z-index: 25;
            pointer-events: none;
        }

        .army-controls {
            background: rgba(39, 174, 96, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #27ae60;
        }

        .size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .size-control input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            padding: 8px;
            color: white;
        }

        .size-control button {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .captured-territory {
            background: linear-gradient(45deg, #e74c3c, #c0392b) !important;
            position: relative;
        }

        .captured-territory::after {
            content: '‚òÖ';
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 8px;
            color: gold;
        }

        .water {
            background: linear-gradient(45deg, #3498db, #2980b9) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="latvia.html" class="back-btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –õ–∞—Ç–≤–∏–∏</a>
        
        <header>
            <h1>üß± –ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã</h1>
            <div style="opacity: 0.9;">–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–º–∏—è–º–∏</div>
        </header>

        <div class="content">
            <div class="map-container">
                <div class="pixel-map" id="pixel-map">
                    <!-- –ü–∏–∫—Å–µ–ª–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                
                <!-- –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="game-system">
                    <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–º–∏—è–º–∏</h2>
                    <div class="unit-controls">
                        <button class="unit-btn" onclick="createArmy('soldier', 100)">‚ûï 100 –°–æ–ª–¥–∞—Ç</button>
                        <button class="unit-btn" onclick="createArmy('soldier', 500)">‚ûï 500 –°–æ–ª–¥–∞—Ç</button>
                        <button class="unit-btn" onclick="createArmy('tank', 50)">‚ûï 50 –¢–∞–Ω–∫–æ–≤</button>
                        <button class="unit-btn" onclick="createArmy('tank', 200)">‚ûï 200 –¢–∞–Ω–∫–æ–≤</button>
                    </div>
                    
                    <div class="army-controls">
                        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Ä–º–∏–∏</h3>
                        <div class="size-control">
                            <input type="number" id="army-size" value="100" min="10" max="10000">
                            <button onclick="createCustomArmy()">–°–æ–∑–¥–∞—Ç—å –∞—Ä–º–∏—é</button>
                        </div>
                        <div style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                            üí° –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —é–Ω–∏—Ç–∞ –Ω–∞ –Ω—É–∂–Ω—É—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é
                        </div>
                    </div>
                    
                    <div id="unit-info" class="unit-info">
                        <div style="text-align: center; opacity: 0.7;">
                            –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä–º–∏—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h2>üé® –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã</h2>
                    <div class="legend">
                        <div class="color-box" style="background-color: #e74c3c;"></div>
                        <span>–õ–∞—Ç–≤–∏—è (–≤–∞—à–∞ —Å—Ç—Ä–∞–Ω–∞)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background: linear-gradient(45deg, #e74c3c, #c0392b);"></div>
                        <span>–ó–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #3498db;"></div>
                        <span>–ê—Ä–º–∏–∏ —Å–æ–ª–¥–∞—Ç</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #e74c3c;"></div>
                        <span>–¢–∞–Ω–∫–æ–≤—ã–µ –∞—Ä–º–∏–∏</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background: linear-gradient(45deg, #3498db, #2980b9);"></div>
                        <span>–í–æ–¥–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</span>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h2>
                    <div class="status-info">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="total-units">0</div>
                                <div class="stat-label">–í–∞—à–∏ –∞—Ä–º–∏–∏</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="captured-territories">0</div>
                                <div class="stat-label">–ó–∞—Ö–≤–∞—á–µ–Ω–æ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="total-soldiers">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–ª–¥–∞—Ç</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="total-tanks">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ —Ç–∞–Ω–∫–æ–≤</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üåç –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω</h2>
                    <div class="country-list" id="country-list">
                        <!-- –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìç –î–µ—Ç–∞–ª–∏ —Ä–µ–≥–∏–æ–Ω–∞</h2>
                    <div class="region-details" id="region-details">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 3em; margin-bottom: 10px;">üß±</div>
                            <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</h3>
                            <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω—ã
        const countryColors = {
            'latvia': '#e74c3c',
            'lithuania': '#1abc9c',
            'estonia': '#9b59b6',
            'finland': '#3498db',
            'norway': '#e67e22',
            'denmark': '#f1c40f',
            'iceland': '#95a5a6',
            'sweden': '#2ecc71',
            'ireland': '#d35400',
            'united_kingdom': '#c0392b',
            'france': '#2980b9',
            'belgium': '#8e44ad',
            'netherlands': '#16a085',
            'germany': '#f39c12',
            'austria': '#27ae60',
            'switzerland': '#e74c3c',
            'portugal': '#9b59b6',
            'spain': '#e67e22',
            'italy': '#3498db',
            'greece': '#1abc9c',
            'croatia': '#d35400',
            'bulgaria': '#2ecc71',
            'albania': '#f39c12',
            'montenegro': '#8e44ad',
            'north_macedonia': '#16a085',
            'hungary': '#c0392b',
            'czechia': '#2980b9',
            'poland': '#27ae60',
            'belarus': '#95a5a6',
            'moldova': '#f1c40f',
            'ukraine': '#e74c3c',
            'romania': '#9b59b6',
            'andorra': '#3498db',
            'monaco': '#1abc9c',
            'luxembourg': '#e67e22',
            'malta': '#2ecc71',
            'liechtenstein': '#d35400',
            'san_marino': '#8e44ad'
        };

        // –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω
        const countriesData = {
            'latvia': { name: '–õ–∞—Ç–≤–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.latvia },
            'austria': { name: '–ê–≤—Å—Ç—Ä–∏—è', player: '–ö–æ–ª—è', color: countryColors.austria },
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã
        };

        // –í–æ–¥–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
        const waterPixels = [
            // –°–µ–≤–µ—Ä–Ω–æ–µ –º–æ—Ä–µ
            ...generateRectangle(15, 8, 10, 5),
            // –ë–∞–ª—Ç–∏–π—Å–∫–æ–µ –º–æ—Ä–µ
            ...generateRectangle(22, 10, 8, 6),
            // –ê—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –æ–∫–µ–∞–Ω
            ...generateRectangle(5, 15, 12, 10),
            // –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–µ –º–æ—Ä–µ
            ...generateRectangle(18, 28, 15, 5)
        ];

        // –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω
        const countryPixels = {
            // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω
        };

        // –ò–≥—Ä–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        const gameState = {
            playerId: 'player_latvia',
            units: [],
            territories: {},
            selectedUnit: null,
            ghostUnit: null
        };

        const unitTypes = {
            soldier: { 
                speed: 1.0, // –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                color: '#3498db',
                symbol: 'üë•'
            },
            tank: { 
                speed: 1.5, // —Ç–∞–Ω–∫–∏ –±—ã—Å—Ç—Ä–µ–µ
                color: '#e74c3c',
                symbol: 'üöó'
            }
        };

        // –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä–º–∏–∏ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º
        function createArmy(type, size) {
            const unit = {
                id: 'unit_' + Date.now(),
                type: type,
                owner: gameState.playerId,
                position: { x: 25, y: 12 },
                size: size,
                isMoving: false,
                movePath: [],
                moveStartTime: null,
                moveDuration: 0
            };

            gameState.units.push(unit);
            renderUnit(unit);
            updateGameStats();
            setupDragAndDrop(unit);
        }

        function createCustomArmy() {
            const size = parseInt(document.getElementById('army-size').value) || 100;
            createArmy('soldier', size);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function setupDragAndDrop(unit) {
            const unitElement = document.getElementById(unit.id);
            
            unitElement.addEventListener('mousedown', startDrag);
            unitElement.addEventListener('touchstart', startDrag);
            
            function startDrag(e) {
                e.preventDefault();
                gameState.selectedUnit = unit;
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–π —é–Ω–∏—Ç
                createGhostUnit(unit);
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag);
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchend', endDrag);
                
                unitElement.classList.add('dragging');
            }
            
            function drag(e) {
                if (!gameState.ghostUnit) return;
                
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                const pixelMap = document.getElementById('pixel-map');
                const rect = pixelMap.getBoundingClientRect();
                
                const x = Math.floor((clientX - rect.left) / 25);
                const y = Math.floor((clientY - rect.top) / 25);
                
                if (x >= 0 && x < 50 && y >= 0 && y < 35) {
                    updateGhostPosition(x, y);
                    showMovementPath(unit.position, {x, y});
                }
            }
            
            function endDrag() {
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('mouseup', endDrag);
                document.removeEventListener('touchend', endDrag);
                
                if (gameState.ghostUnit && gameState.selectedUnit) {
                    const targetPos = {
                        x: parseInt(gameState.ghostUnit.style.left) / 25,
                        y: parseInt(gameState.ghostUnit.style.top) / 25
                    };
                    
                    moveUnit(gameState.selectedUnit, targetPos);
                }
                
                cleanupDrag();
            }
        }

        function createGhostUnit(unit) {
            const pixelMap = document.getElementById('pixel-map');
            const ghost = document.createElement('div');
            
            ghost.className = `unit ${unit.type} ghost`;
            ghost.style.left = (unit.position.x * 25 + 2) + 'px';
            ghost.style.top = (unit.position.y * 25 + 2) + 'px';
            ghost.style.background = unitTypes[unit.type].color;
            ghost.innerHTML = unitTypes[unit.type].symbol;
            
            pixelMap.appendChild(ghost);
            gameState.ghostUnit = ghost;
        }

        function updateGhostPosition(x, y) {
            if (gameState.ghostUnit) {
                gameState.ghostUnit.style.left = (x * 25 + 2) + 'px';
                gameState.ghostUnit.style.top = (y * 25 + 2) + 'px';
            }
        }

        function showMovementPath(start, end) {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—É—Ç—å
            document.querySelectorAll('.movement-path, .movement-time').forEach(el => el.remove());
            
            const distance = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
            const isWater = checkWaterPath(start, end);
            const speedMultiplier = isWater ? 0.4 : 1.0; // –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –Ω–∞ –≤–æ–¥–µ
            const duration = calculateMoveDuration(distance, speedMultiplier);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            const timeElement = document.createElement('div');
            timeElement.className = 'movement-time';
            timeElement.style.left = (end.x * 25 + 5) + 'px';
            timeElement.style.top = (end.y * 25 - 15) + 'px';
            timeElement.textContent = formatDuration(duration);
            
            document.getElementById('pixel-map').appendChild(timeElement);
        }

        function checkWaterPath(start, end) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏ –ø—É—Ç—å —á–µ—Ä–µ–∑ –≤–æ–¥—É
            const steps = Math.max(Math.abs(end.x - start.x), Math.abs(end.y - start.y));
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const x = Math.round(start.x + (end.x - start.x) * t);
                const y = Math.round(start.y + (end.y - start.y) * t);
                
                if (isWaterPixel(x, y)) {
                    return true;
                }
            }
            return false;
        }

        function isWaterPixel(x, y) {
            return waterPixels.some(([px, py]) => px === x && py === y);
        }

        function calculateMoveDuration(distance, speedMultiplier) {
            const baseHoursPerPixel = 2; // 2 —á–∞—Å–∞ –Ω–∞ –ø–∏–∫—Å–µ–ª—å
            return Math.round(distance * baseHoursPerPixel * speedMultiplier);
        }

        function formatDuration(hours) {
            if (hours < 24) {
                return `${hours}—á`;
            } else {
                const days = Math.floor(hours / 24);
                const remainingHours = hours % 24;
                return `${days}–¥ ${remainingHours}—á`;
            }
        }

        function moveUnit(unit, targetPos) {
            const distance = Math.sqrt(Math.pow(targetPos.x - unit.position.x, 2) + Math.pow(targetPos.y - unit.position.y, 2));
            const isWater = checkWaterPath(unit.position, targetPos);
            const speedMultiplier = isWater ? 0.4 : 1.0;
            const duration = calculateMoveDuration(distance, speedMultiplier);
            
            unit.isMoving = true;
            unit.movePath = [unit.position, targetPos];
            unit.moveStartTime = Date.now();
            unit.moveDuration = duration * 3600000; // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
            
            // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            const unitElement = document.getElementById(unit.id);
            unitElement.classList.add('moving');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            const startTime = Date.now();
            const startPos = {...unit.position};
            
            function animateMove() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / unit.moveDuration, 1);
                
                if (progress < 1) {
                    const currentX = startPos.x + (targetPos.x - startPos.x) * progress;
                    const currentY = startPos.y + (targetPos.y - startPos.y) * progress;
                    
                    unitElement.style.left = (currentX * 25 + 2) + 'px';
                    unitElement.style.top = (currentY * 25 + 2) + 'px';
                    
                    requestAnimationFrame(animateMove);
                } else {
                    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    unit.position = targetPos;
                    unit.isMoving = false;
                    unitElement.classList.remove('moving');
                    checkForCapture(unit);
                }
            }
            
            animateMove();
        }

        function cleanupDrag() {
            if (gameState.ghostUnit) {
                gameState.ghostUnit.remove();
                gameState.ghostUnit = null;
            }
            
            document.querySelectorAll('.movement-path, .movement-time').forEach(el => el.remove());
            
            if (gameState.selectedUnit) {
                const unitElement = document.getElementById(gameState.selectedUnit.id);
                if (unitElement) {
                    unitElement.classList.remove('dragging');
                }
                gameState.selectedUnit = null;
            }
        }

        function checkForCapture(unit) {
            const country = findCountryForPixel(unit.position.x, unit.position.y);
            if (country && country !== 'latvia') {
                const territoryKey = `${unit.position.x},${unit.position.y}`;
                gameState.territories[territoryKey] = {
                    originalCountry: country,
                    capturedBy: unit.owner,
                    unitId: unit.id,
                    timestamp: Date.now()
                };

                const pixel = findPixelByCoord(unit.position.x, unit.position.y);
                if (pixel) {
                    pixel.classList.add('captured-territory');
                    pixel.title = `–ó–∞—Ö–≤–∞—á–µ–Ω–æ –õ–∞—Ç–≤–∏–µ–π\n–ê—Ä–º–∏—è: ${unit.size} ${getUnitName(unit.type)}`;
                }

                updateGameStats();
            }
        }

        function renderUnit(unit) {
            const pixelMap = document.getElementById('pixel-map');
            const unitElement = document.createElement('div');
            
            unitElement.className = `unit ${unit.type}`;
            unitElement.id = unit.id;
            unitElement.style.left = (unit.position.x * 25 + 2) + 'px';
            unitElement.style.top = (unit.position.y * 25 + 2) + 'px';
            unitElement.style.background = unitTypes[unit.type].color;
            unitElement.innerHTML = `${unitTypes[unit.type].symbol}<div style="font-size:8px">${unit.size}</div>`;

            pixelMap.appendChild(unitElement);
        }

        function selectUnit(unit) {
            const unitInfo = document.getElementById('unit-info');
            unitInfo.innerHTML = `
                <strong>${getUnitName(unit.type)} –∞—Ä–º–∏—è</strong>
                <div class="detail-item">
                    <span class="detail-label">–†–∞–∑–º–µ—Ä:</span>
                    <span class="detail-value">${unit.size} —é–Ω–∏—Ç–æ–≤</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ü–æ–∑–∏—Ü–∏—è:</span>
                    <span class="detail-value">${unit.position.x},${unit.position.y}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="detail-value">${unit.isMoving ? '–í –¥–≤–∏–∂–µ–Ω–∏–∏' : '–ù–∞ –º–µ—Å—Ç–µ'}</span>
                </div>
                <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                    üí° –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
                </div>
            `;
        }

        function getUnitName(type) {
            const names = { soldier: '–°–æ–ª–¥–∞—Ç—Å–∫–∞—è', tank: '–¢–∞–Ω–∫–æ–≤–∞—è' };
            return names[type] || type;
        }

        function updateGameStats() {
            const playerUnits = gameState.units.filter(u => u.owner === gameState.playerId).length;
            const captured = Object.keys(gameState.territories).length;
            const totalSoldiers = gameState.units
                .filter(u => u.owner === gameState.playerId && u.type === 'soldier')
                .reduce((sum, unit) => sum + unit.size, 0);
            const totalTanks = gameState.units
                .filter(u => u.owner === gameState.playerId && u.type === 'tank')
                .reduce((sum, unit) => sum + unit.size, 0);
            
            document.getElementById('total-units').textContent = playerUnits;
            document.getElementById('captured-territories').textContent = captured;
            document.getElementById('total-soldiers').textContent = totalSoldiers;
            document.getElementById('total-tanks').textContent = totalTanks;
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞—Ä—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        function generateRectangle(startX, startY, width, height) {
            const pixels = [];
            for (let x = startX; x < startX + width; x++) {
                for (let y = startY; y < startY + height; y++) {
                    pixels.push([x, y]);
                }
            }
            return pixels;
        }

        function createPixelMap() {
            const pixelMap = document.getElementById('pixel-map');
            pixelMap.innerHTML = '';

            for (let y = 0; y < 35; y++) {
                for (let x = 0; x < 50; x++) {
                    const pixel = document.createElement('div');
                    pixel.className = 'pixel';
                    pixel.dataset.x = x;
                    pixel.dataset.y = y;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–¥—É
                    if (isWaterPixel(x, y)) {
                        pixel.classList.add('water');
                        pixel.textContent = '~';
                        continue;
                    }
                    
                    const country = findCountryForPixel(x, y);
                    if (country && countriesData[country]) {
                        pixel.dataset.country = country;
                        pixel.style.background = countriesData[country].color;
                        
                        if (country === 'latvia') {
                            pixel.classList.add('latvia');
                        }
                        
                        pixel.textContent = getCountryCode(country);
                    } else {
                        pixel.classList.add('empty');
                    }
                    
                    pixel.addEventListener('mouseenter', handlePixelHover);
                    pixel.addEventListener('mouseleave', handlePixelLeave);
                    
                    pixelMap.appendChild(pixel);
                }
            }
            
            addCountryBorders();
            updateStatistics();
            createCountryList();
            updateGameStats();
        }

        function findCountryForPixel(x, y) {
            for (const [country, pixels] of Object.entries(countryPixels)) {
                if (pixels.some(([px, py]) => px === x && py === y)) {
                    return country;
                }
            }
            return null;
        }

        function findPixelByCoord(x, y) {
            return document.querySelector(`.pixel[data-x="${x}"][data-y="${y}"]`);
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞—Ä—Ç—ã...
        document.addEventListener('DOMContentLoaded', initialize);

        function initialize() {
            createPixelMap();
            // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∞—Ä–º–∏–π
            setTimeout(() => {
                createArmy('soldier', 500);
                createArmy('tank', 50);
            }, 1000);
        }
    </script>
</body>
</html>

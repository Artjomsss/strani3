<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c0c1a, #1a1a2e);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.25), rgba(39, 174, 96, 0.2));
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.15);
        }

        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2ecc71, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .map-container {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }

        .pixel-map {
            display: grid;
            grid-template-columns: repeat(50, 25px);
            grid-template-rows: repeat(35, 25px);
            gap: 1px;
            background: #2a2a40;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #3a3a5a;
            position: relative;
            margin: 0 auto;
            max-width: fit-content;
        }

        .pixel {
            width: 25px;
            height: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            border: 1px solid rgba(0,0,0,0.3);
            user-select: none;
        }

        .pixel:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 0 2px #f39c12, 0 0 15px rgba(243, 156, 18, 0.5);
        }

        .pixel.empty {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .pixel.latvia {
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .country-border {
            position: absolute;
            background: rgba(0,0,0,0.9);
            z-index: 5;
            pointer-events: none;
        }

        .border-top { top: -1px; left: 0; width: 100%; height: 1px; }
        .border-right { top: 0; right: -1px; width: 1px; height: 100%; }
        .border-bottom { bottom: -1px; left: 0; width: 100%; height: 1px; }
        .border-left { top: 0; left: -1px; width: 1px; height: 100%; }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .control-group {
            margin-bottom: 25px;
        }

        h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h3 {
            color: #2ecc71;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .legend {
            display: grid;
            grid-template-columns: 20px 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .status-info {
            background: rgba(52, 152, 219, 0.15);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .region-details {
            background: rgba(39, 174, 96, 0.15);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #27ae60;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-label {
            font-weight: bold;
            color: #bdc3c7;
        }

        .detail-value {
            color: #ecf0f1;
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255,255,255,0.08);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .country-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #3498db;
        }

        .coordinates {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .back-btn {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: linear-gradient(145deg, #2980b9, #21618c);
            transform: translateY(-2px);
        }

        .country-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .country-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .player-name {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .game-system {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            margin-top: 20px;
        }

        .unit-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .unit-btn {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .unit-btn:hover {
            background: linear-gradient(145deg, #2980b9, #21618c);
            transform: translateY(-2px);
        }

        .unit-info {
            background: rgba(52, 152, 219, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }

        .unit {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            z-index: 20;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto;
        }

        .unit.dragging {
            opacity: 0.7;
            transform: scale(1.3);
            z-index: 100;
            cursor: grabbing;
        }

        .unit.ghost {
            opacity: 0.4;
            z-index: 90;
            pointer-events: none;
        }

        .unit.soldier {
            background: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
        }

        .unit.moving {
            animation: pulseMove 2s infinite;
        }

        @keyframes pulseMove {
            0% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor; }
            100% { box-shadow: 0 0 5px currentColor; }
        }

        .movement-path {
            position: absolute;
            background: rgba(52, 152, 219, 0.3);
            border-radius: 2px;
            z-index: 10;
            pointer-events: none;
        }

        .movement-time {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            z-index: 25;
            pointer-events: none;
            white-space: nowrap;
        }

        .army-controls {
            background: rgba(39, 174, 96, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #27ae60;
        }

        .size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .size-control input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            padding: 8px;
            color: white;
        }

        .size-control button {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .captured-territory {
            background: linear-gradient(45deg, #e74c3c, #c0392b) !important;
            position: relative;
        }

        .captured-territory::after {
            content: '‚òÖ';
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 8px;
            color: gold;
        }

        .db-status {
            background: rgba(155, 89, 182, 0.15);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #9b59b6;
            font-size: 0.9em;
        }

        .radial-menu {
            position: absolute;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .radial-menu.active {
            pointer-events: all;
            opacity: 1;
            transform: scale(1);
        }

        .radial-menu-item {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(145deg, #3498db, #2980b9);
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transform: scale(0.8);
        }

        .radial-menu.active .radial-menu-item {
            transform: scale(1);
        }

        .radial-menu-item:hover {
            transform: scale(1.2) !important;
            background: linear-gradient(145deg, #2980b9, #21618c);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .radial-menu-center {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            z-index: 10;
        }

        .menu-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1001;
        }

        .radial-menu-item:hover .menu-tooltip {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="latvia.html" class="back-btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –õ–∞—Ç–≤–∏–∏</a>
        
        <header>
            <h1>üß± –ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã</h1>
            <div style="opacity: 0.9;">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ä¢ –¢–æ—á–Ω—ã–π –∑–∞—Ö–≤–∞—Ç ‚Ä¢ –†–∞–¥–∏–∞–ª—å–Ω–æ–µ –º–µ–Ω—é</div>
        </header>

        <div class="content">
            <div class="map-container">
                <div class="pixel-map" id="pixel-map">
                    <!-- –ü–∏–∫—Å–µ–ª–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                
                <div id="radial-menu" class="radial-menu">
                    <div class="radial-menu-center">‚öôÔ∏è</div>
                </div>
                
                <div class="game-system">
                    <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–º–∏—è–º–∏</h2>
                    <div class="unit-controls">
                        <button class="unit-btn" onclick="createArmy(100)">‚ûï 100 –°–æ–ª–¥–∞—Ç</button>
                        <button class="unit-btn" onclick="createArmy(500)">‚ûï 500 –°–æ–ª–¥–∞—Ç</button>
                        <button class="unit-btn" onclick="createArmy(1000)">‚ûï 1000 –°–æ–ª–¥–∞—Ç</button>
                        <button class="unit-btn" onclick="createArmy(2000)">‚ûï 2000 –°–æ–ª–¥–∞—Ç</button>
                    </div>
                    
                    <div class="army-controls">
                        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Ä–º–∏–∏</h3>
                        <div class="size-control">
                            <input type="number" id="army-size" value="100" min="10" max="10000">
                            <button onclick="createCustomArmy()">–°–æ–∑–¥–∞—Ç—å –∞—Ä–º–∏—é</button>
                        </div>
                        <div style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                            üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∞—Ä–º–∏—é –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        </div>
                    </div>
                    
                    <div id="unit-info" class="unit-info">
                        <div style="text-align: center; opacity: 0.7;">
                            –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä–º–∏—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        </div>
                    </div>

                    <div class="db-status" id="db-status">
                        üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h2>üé® –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã</h2>
                    <div class="legend">
                        <div class="color-box" style="background-color: #e74c3c;"></div>
                        <span>–õ–∞—Ç–≤–∏—è (–≤–∞—à–∞ —Å—Ç—Ä–∞–Ω–∞)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background: linear-gradient(45deg, #e74c3c, #c0392b);"></div>
                        <span>–ó–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #3498db;"></div>
                        <span>–ê—Ä–º–∏–∏ —Å–æ–ª–¥–∞—Ç</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #95a5a6;"></div>
                        <span>–°–≤–æ–±–æ–¥–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)</span>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</h2>
                    <div class="status-info">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="total-units">0</div>
                                <div class="stat-label">–í–∞—à–∏ –∞—Ä–º–∏–∏</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="captured-territories">0</div>
                                <div class="stat-label">–ó–∞—Ö–≤–∞—á–µ–Ω–æ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="total-soldiers">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–ª–¥–∞—Ç</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="moving-units">0</div>
                                <div class="stat-label">–í –¥–≤–∏–∂–µ–Ω–∏–∏</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üåç –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω</h2>
                    <div class="country-list" id="country-list">
                        <!-- –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìç –î–µ—Ç–∞–ª–∏ —Ä–µ–≥–∏–æ–Ω–∞</h2>
                    <div class="region-details" id="region-details">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 3em; margin-bottom: 10px;">üß±</div>
                            <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</h3>
                            <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDRUoIzXpwwAGYM0qciAYdQm-wtMKqLsVs",
            authDomain: "strani3.firebaseapp.com",
            databaseURL: "https://strani3-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "strani3",
            storageBucket: "strani3.firebasestorage.app",
            messagingSenderId: "225168183800",
            appId: "1:225168183800:web:825e782a35bccca89d460d",
            measurementId: "G-3NKBET5R9J"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            document.getElementById('db-status').innerHTML = '‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞';
        } catch (error) {
            console.log("Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ");
            document.getElementById('db-status').innerHTML = '‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)';
        }

        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω—ã
        const countryColors = {
            'latvia': '#e74c3c',
            'lithuania': '#1abc9c',
            'estonia': '#9b59b6',
            'finland': '#3498db',
            'norway': '#e67e22',
            'denmark': '#f1c40f',
            'iceland': '#95a5a6',
            'france': '#2980b9',
            'belgium': '#8e44ad',
            'netherlands': '#16a085',
            'germany': '#f39c12',
            'austria': '#27ae60',
            'switzerland': '#e74c3c',
            'portugal': '#9b59b6',
            'spain': '#e67e22',
            'italy': '#3498db',
            'greece': '#1abc9c',
            'croatia': '#d35400',
            'bulgaria': '#2ecc71',
            'albania': '#f39c12',
            'montenegro': '#8e44ad',
            'north_macedonia': '#16a085',
            'hungary': '#c0392b',
            'czechia': '#2980b9',
            'poland': '#27ae60',
            'belarus': '#95a5a6',
            'moldova': '#f1c40f',
            'ukraine': '#e74c3c',
            'romania': '#9b59b6'
        };

        // –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω
        const countriesData = {
            'latvia': { name: '–õ–∞—Ç–≤–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.latvia },
            'austria': { name: '–ê–≤—Å—Ç—Ä–∏—è', player: '–ö–æ–ª—è', color: countryColors.austria },
            'belarus': { name: '–ë–µ–ª–∞—Ä—É—Å—å', player: '–≠–ª—è', color: countryColors.belarus },
            'belgium': { name: '–ë–µ–ª—å–≥–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.belgium },
            'bulgaria': { name: '–ë–æ–ª–≥–∞—Ä–∏—è', player: '–ö–æ—Å—Ç—è', color: countryColors.bulgaria },
            'croatia': { name: '–•–æ—Ä–≤–∞—Ç–∏—è', player: '–í–∏–∫–∞ –î—Ä—É', color: countryColors.croatia },
            'czechia': { name: '–ß–µ—Ö–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.czechia },
            'denmark': { name: '–î–∞–Ω–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.denmark },
            'estonia': { name: '–≠—Å—Ç–æ–Ω–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.estonia },
            'finland': { name: '–§–∏–Ω–ª—è–Ω–¥–∏—è', player: '–õ—ë—à–∞', color: countryColors.finland },
            'france': { name: '–§—Ä–∞–Ω—Ü–∏—è', player: '–ü–æ–ª–∏–Ω–∞', color: countryColors.france },
            'germany': { name: '–ì–µ—Ä–º–∞–Ω–∏—è', player: '–ù–∏–∫–∏—Ç–∞ –ò.', color: countryColors.germany },
            'greece': { name: '–ì—Ä–µ—Ü–∏—è', player: '–ú–∏–ª–∞–Ω–∞', color: countryColors.greece },
            'hungary': { name: '–í–µ–Ω–≥—Ä–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.hungary },
            'iceland': { name: '–ò—Å–ª–∞–Ω–¥–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.iceland },
            'italy': { name: '–ò—Ç–∞–ª–∏—è', player: '–≠–≤–µ–ª–∏–Ω–∞', color: countryColors.italy },
            'lithuania': { name: '–õ–∏—Ç–≤–∞', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.lithuania },
            'moldova': { name: '–ú–æ–ª–¥–∞–≤–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.moldova },
            'montenegro': { name: '–ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è', player: '–ö–∏—Ä–∞', color: countryColors.montenegro },
            'netherlands': { name: '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.netherlands },
            'north_macedonia': { name: '–°–µ–≤–µ—Ä–Ω–∞—è –ú–∞–∫–µ–¥–æ–Ω–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.north_macedonia },
            'norway': { name: '–ù–æ—Ä–≤–µ–≥–∏—è', player: '–í–µ—Ä–æ–Ω–∏–∫–∞', color: countryColors.norway },
            'poland': { name: '–ü–æ–ª—å—à–∞', player: '–î–∞–Ω–∏–∫', color: countryColors.poland },
            'portugal': { name: '–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.portugal },
            'albania': { name: '–ê–ª–±–∞–Ω–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.albania },
            'romania': { name: '–†—É–º—ã–Ω–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.romania },
            'switzerland': { name: '–®–≤–µ–π—Ü–∞—Ä–∏—è', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.switzerland },
            'ukraine': { name: '–£–∫—Ä–∞–∏–Ω–∞', player: '–Ω–µ –∑–∞–Ω—è—Ç–æ', color: countryColors.ukraine }
        };

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω - –§–∏–Ω–ª—è–Ω–¥–∏—è –∏ –ü—Ä–∏–±–∞–ª—Ç–∏–∫–∞ –ø–æ–¥–Ω—è—Ç—ã –Ω–∞ 5 –∫–ª–µ—Ç–æ–∫ –≤–≤–µ—Ä—Ö
        const countryPixels = {
            // –°–∫–∞–Ω–¥–∏–Ω–∞–≤–∏—è (–ø–æ–¥–Ω—è—Ç–∞ –≤–≤–µ—Ä—Ö)
            'norway': generateRectangle(20, 0, 3, 8),
            'finland': generateRectangle(27, 0, 4, 6),
            'denmark': generateRectangle(22, 5, 3, 2),
            'iceland': generateRectangle(15, 0, 3, 3),
            
            // –ë–∞–ª—Ç–∏–π—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω—ã (–ø–æ–¥–Ω—è—Ç—ã –≤–≤–µ—Ä—Ö)
            'estonia': generateRectangle(28, 7, 3, 2),
            'latvia': generateRectangle(28, 9, 3, 2),
            'lithuania': generateRectangle(28, 11, 3, 2),
            
            // –ó–∞–ø–∞–¥–Ω–∞—è –ï–≤—Ä–æ–ø–∞ (–æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –º–µ—Å—Ç–µ)
            'france': generateRectangle(20, 16, 5, 4),
            'belgium': generateRectangle(22, 15, 2, 2),
            'netherlands': generateRectangle(22, 13, 2, 2),
            'germany': generateRectangle(23, 14, 5, 4),
            
            // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ï–≤—Ä–æ–ø–∞ (–æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –º–µ—Å—Ç–µ)
            'switzerland': generateRectangle(22, 18, 2, 2),
            'austria': generateRectangle(24, 17, 3, 3),
            'czechia': generateRectangle(24, 15, 3, 2),
            'poland': generateRectangle(26, 14, 4, 4),
            
            // –í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞ (–æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –º–µ—Å—Ç–µ)
            'belarus': generateRectangle(29, 14, 4, 3),
            'ukraine': generateRectangle(29, 17, 6, 4),
            
            // –Æ–∂–Ω–∞—è –ï–≤—Ä–æ–ø–∞ (–æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –º–µ—Å—Ç–µ)
            'portugal': generateRectangle(17, 19, 2, 3),
            'spain': generateRectangle(19, 19, 4, 4),
            'italy': generateRectangle(24, 21, 3, 5),
            
            // –ë–∞–ª–∫–∞–Ω—ã (–æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –º–µ—Å—Ç–µ)
            'hungary': generateRectangle(26, 18, 3, 2),
            'romania': generateRectangle(28, 19, 3, 3),
            'bulgaria': generateRectangle(29, 22, 3, 2),
            'greece': generateRectangle(28, 24, 4, 3),
            'croatia': generateRectangle(25, 19, 3, 2),
            'albania': generateRectangle(26, 22, 2, 2),
            'montenegro': generateRectangle(25, 21, 2, 2),
            'north_macedonia': generateRectangle(27, 22, 2, 2),
            'moldova': generateRectangle(30, 19, 2, 2)
        };

        // –ò–≥—Ä–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        const gameState = {
            playerId: 'player_latvia',
            units: [],
            territories: {},
            selectedUnit: null,
            ghostUnit: null,
            radialMenu: {
                active: false,
                unit: null
            }
        };

        // –ö–û–ù–°–¢–ê–ù–¢–ê –°–ú–ï–©–ï–ù–ò–Ø –í–õ–ï–í–û
        const LEFT_OFFSET = -30; // –°–º–µ—â–µ–Ω–∏–µ –≤–ª–µ–≤–æ –Ω–∞ 3 –ø–∏–∫—Å–µ–ª—è

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–∏–∫—Å–µ–ª—è
        function getPixelCoordinates(x, y) {
            const pixelMap = document.getElementById('pixel-map');
            const rect = pixelMap.getBoundingClientRect();
            
            // –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç - –∫–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å 25x25, –æ—Ç—Å—Ç—É–ø—ã 20px
            const pixelLeft = x * 25 + 20;
            const pixelTop = y * 25 + 20;
            
            return { left: pixelLeft, top: pixelTop };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–ª–∏–∫–∞
        function getExactCoordinates(e) {
            const pixelMap = document.getElementById('pixel-map');
            const rect = pixelMap.getBoundingClientRect();
            
            const relativeX = e.clientX - rect.left - 20; // 20px padding
            const relativeY = e.clientY - rect.top - 20;  // 20px padding
            
            const x = Math.floor(relativeX / 25);
            const y = Math.floor(relativeY / 25);
            
            return { x, y };
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–¥–∏–∞–ª—å–Ω—ã–º –º–µ–Ω—é
        function createRadialMenu(unit, x, y) {
            const radialMenu = document.getElementById('radial-menu');
            radialMenu.innerHTML = '<div class="radial-menu-center">‚öôÔ∏è</div>';
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –º–µ–Ω—é —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
            const pixelPos = getPixelCoordinates(x, y);
            const centerOffset = 2.5;
            
            radialMenu.style.left = (pixelPos.left + centerOffset + LEFT_OFFSET - 30) + 'px';
            radialMenu.style.top = (pixelPos.top + centerOffset - 30) + 'px';
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é
            const menuItems = [
                { icon: 'üöÄ', action: 'move', tooltip: '–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å' },
                { icon: 'üóëÔ∏è', action: 'delete', tooltip: '–£–¥–∞–ª–∏—Ç—å' },
                { icon: 'üìä', action: 'info', tooltip: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' },
                { icon: '‚öîÔ∏è', action: 'attack', tooltip: '–ê—Ç–∞–∫–æ–≤–∞—Ç—å' },
                { icon: 'üîÑ', action: 'split', tooltip: '–†–∞–∑–¥–µ–ª–∏—Ç—å' },
                { icon: 'üìà', action: 'upgrade', tooltip: '–£–ª—É—á—à–∏—Ç—å' }
            ];
            
            const radius = 80;
            const angleStep = (2 * Math.PI) / menuItems.length;
            
            menuItems.forEach((item, index) => {
                const angle = index * angleStep;
                const itemX = Math.cos(angle) * radius;
                const itemY = Math.sin(angle) * radius;
                
                const menuItem = document.createElement('div');
                menuItem.className = 'radial-menu-item';
                menuItem.innerHTML = item.icon;
                menuItem.style.left = (30 + itemX) + 'px';
                menuItem.style.top = (30 + itemY) + 'px';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                const tooltip = document.createElement('div');
                tooltip.className = 'menu-tooltip';
                tooltip.textContent = item.tooltip;
                tooltip.style.top = '-30px';
                tooltip.style.left = '50%';
                tooltip.style.transform = 'translateX(-50%)';
                menuItem.appendChild(tooltip);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                menuItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleMenuAction(item.action, unit);
                });
                
                radialMenu.appendChild(menuItem);
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –º–µ–Ω—é
            radialMenu.classList.add('active');
            gameState.radialMenu.active = true;
            gameState.radialMenu.unit = unit;
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            setTimeout(() => {
                document.addEventListener('click', closeRadialMenu);
            }, 10);
        }

        function closeRadialMenu() {
            const radialMenu = document.getElementById('radial-menu');
            radialMenu.classList.remove('active');
            gameState.radialMenu.active = false;
            gameState.radialMenu.unit = null;
            document.removeEventListener('click', closeRadialMenu);
        }

        function handleMenuAction(action, unit) {
            console.log(`–í—ã–±—Ä–∞–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ: ${action} –¥–ª—è –∞—Ä–º–∏–∏ ${unit.id}`);
            
            switch (action) {
                case 'move':
                    startDragMode(unit);
                    break;
                case 'delete':
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å –∞—Ä–º–∏—é –∏–∑ ${unit.size} —Å–æ–ª–¥–∞—Ç?`)) {
                        deleteUnit(unit);
                    }
                    break;
                case 'info':
                    showUnitInfo(unit);
                    break;
                case 'attack':
                    alert(`–ê—Ä–º–∏—è –∏–∑ ${unit.size} —Å–æ–ª–¥–∞—Ç –≥–æ—Ç–æ–≤–∞ –∫ –∞—Ç–∞–∫–µ!`);
                    break;
                case 'split':
                    splitUnit(unit);
                    break;
                case 'upgrade':
                    upgradeUnit(unit);
                    break;
            }
            
            closeRadialMenu();
        }

        function startDragMode(unit) {
            if (unit.isMoving) {
                alert('–ê—Ä–º–∏—è —É–∂–µ –≤ –¥–≤–∏–∂–µ–Ω–∏–∏!');
                return;
            }
            
            gameState.selectedUnit = unit;
            createGhostUnit(unit);
            
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.classList.add('dragging');
            }
            
            // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            document.addEventListener('mousemove', dragUnit);
            document.addEventListener('mouseup', endDragUnit);
            
            alert('–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—Ä–º–∏—é –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ');
        }

        function dragUnit(e) {
            if (!gameState.ghostUnit || !gameState.selectedUnit) return;
            
            const { x, y } = getExactCoordinates(e);
            
            if (x >= 0 && x < 50 && y >= 0 && y < 35) {
                updateGhostPosition(x, y);
                showMovementPath(gameState.selectedUnit.position, {x, y});
            }
        }

        function endDragUnit(e) {
            if (gameState.ghostUnit && gameState.selectedUnit) {
                const { x, y } = getExactCoordinates(e);
                
                console.log('üéØ –§–ò–ù–ê–õ–¨–ù–´–ï –ö–û–û–†–î–ò–ù–ê–¢–´ –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–Ø:', {x, y});
                
                if (x >= 0 && x < 50 && y >= 0 && y < 35) {
                    if (x !== gameState.selectedUnit.position.x || y !== gameState.selectedUnit.position.y) {
                        moveUnit(gameState.selectedUnit, {x, y});
                    }
                }
            }
            
            cleanupDrag();
            document.removeEventListener('mousemove', dragUnit);
            document.removeEventListener('mouseup', endDragUnit);
        }

        function deleteUnit(unit) {
            gameState.units = gameState.units.filter(u => u.id !== unit.id);
            
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.remove();
            }
            
            if (database) {
                database.ref('units/' + unit.id).remove();
            } else {
                localStorage.removeItem('game_units/' + unit.id);
            }
            
            updateGameStats();
            document.getElementById('unit-info').innerHTML = '<div style="text-align: center; opacity: 0.7;">–ê—Ä–º–∏—è —É–¥–∞–ª–µ–Ω–∞</div>';
        }

        function showUnitInfo(unit) {
            const unitInfo = document.getElementById('unit-info');
            const remainingTime = unit.isMoving ? 
                formatDuration(Math.round((unit.moveDuration - (Date.now() - unit.moveStartTime)) / 1000)) : 
                '–ù–∞ –º–µ—Å—Ç–µ';
                
            unitInfo.innerHTML = `
                <strong>–ê—Ä–º–∏—è —Å–æ–ª–¥–∞—Ç</strong>
                <div class="detail-item">
                    <span class="detail-label">ID:</span>
                    <span class="detail-value">${unit.id.substring(0, 8)}...</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–†–∞–∑–º–µ—Ä:</span>
                    <span class="detail-value">${unit.size} —Å–æ–ª–¥–∞—Ç</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ü–æ–∑–∏—Ü–∏—è:</span>
                    <span class="detail-value">${unit.position.x},${unit.position.y}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="detail-value">${unit.isMoving ? `–í –¥–≤–∏–∂–µ–Ω–∏–∏ (${remainingTime})` : '–ù–∞ –º–µ—Å—Ç–µ'}</span>
                </div>
                <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                    üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–¥–∏–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </div>
            `;
        }

        function splitUnit(unit) {
            if (unit.size < 200) {
                alert('–ê—Ä–º–∏—è —Å–ª–∏—à–∫–æ–º –º–∞–ª–∞ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 200 —Å–æ–ª–¥–∞—Ç)');
                return;
            }
            
            const halfSize = Math.floor(unit.size / 2);
            unit.size = halfSize;
            
            const newUnit = {
                id: 'unit_' + Date.now(),
                type: 'soldier',
                owner: gameState.playerId,
                position: { ...unit.position },
                size: halfSize,
                isMoving: false
            };
            
            gameState.units.push(newUnit);
            renderUnit(newUnit);
            setupUnitClick(newUnit);
            
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.innerHTML = `üë•<div style="font-size:8px">${unit.size}</div>`;
            }
            
            saveToDatabase('units/' + unit.id, unit);
            saveToDatabase('units/' + newUnit.id, newUnit);
            
            updateGameStats();
            alert(`–ê—Ä–º–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –¥–≤–µ –ø–æ ${halfSize} —Å–æ–ª–¥–∞—Ç`);
        }

        function upgradeUnit(unit) {
            const upgradeCost = Math.floor(unit.size * 1.5);
            const newSize = Math.floor(unit.size * 1.2);
            
            if (confirm(`–£–ª—É—á—à–∏—Ç—å –∞—Ä–º–∏—é –¥–æ ${newSize} —Å–æ–ª–¥–∞—Ç? –°—Ç–æ–∏–º–æ—Å—Ç—å: ${upgradeCost} —Ä–µ—Å—É—Ä—Å–æ–≤`)) {
                unit.size = newSize;
                
                const unitElement = document.getElementById(unit.id);
                if (unitElement) {
                    unitElement.innerHTML = `üë•<div style="font-size:8px">${unit.size}</div>`;
                    unitElement.style.background = '#9b59b6';
                }
                
                saveToDatabase('units/' + unit.id, unit);
                updateGameStats();
                alert(`–ê—Ä–º–∏—è —É–ª—É—á—à–µ–Ω–∞ –¥–æ ${newSize} —Å–æ–ª–¥–∞—Ç!`);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        function saveToDatabase(path, data) {
            if (database) {
                database.ref(path).set(data)
                    .then(() => console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', path))
                    .catch(error => console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error));
            } else {
                localStorage.setItem('game_' + path, JSON.stringify(data));
            }
        }

        function loadFromDatabase(path, callback) {
            if (database) {
                database.ref(path).on('value', (snapshot) => {
                    const data = snapshot.val();
                    callback(data);
                });
            } else {
                const data = JSON.parse(localStorage.getItem('game_' + path) || 'null');
                callback(data);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä–º–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
        function createArmy(size) {
            const unit = {
                id: 'unit_' + Date.now(),
                type: 'soldier',
                owner: gameState.playerId,
                position: { x: 28, y: 9 },
                size: size,
                isMoving: false
            };

            gameState.units.push(unit);
            renderUnit(unit);
            setupUnitClick(unit);
            updateGameStats();
            
            saveToDatabase('units/' + unit.id, unit);
            
            console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∞—Ä–º–∏—è –≤ –õ–∞—Ç–≤–∏–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ ${unit.position.x},${unit.position.y}`);
        }

        function createCustomArmy() {
            const size = parseInt(document.getElementById('army-size').value) || 100;
            createArmy(size);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —é–Ω–∏—Ç—É
        function setupUnitClick(unit) {
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!gameState.radialMenu.active) {
                        const x = unit.position.x;
                        const y = unit.position.y;
                        createRadialMenu(unit, x, y);
                    }
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —é–Ω–∏—Ç
        function debugUnitPosition(unit) {
            const country = findCountryForPixel(unit.position.x, unit.position.y);
            console.log(`üîç –ê—Ä–º–∏—è ${unit.id} –Ω–∞ ${unit.position.x},${unit.position.y} - —Å—Ç—Ä–∞–Ω–∞: ${country || '–ú–û–†–ï/–ù–ï–¢'}`);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ–π
        function generateRectangle(startX, startY, width, height) {
            const pixels = [];
            for (let x = startX; x < startX + width; x++) {
                for (let y = startY; y < startY + height; y++) {
                    pixels.push([x, y]);
                }
            }
            return pixels;
        }

        function createPixelMap() {
            const pixelMap = document.getElementById('pixel-map');
            pixelMap.innerHTML = '';

            for (let y = 0; y < 35; y++) {
                for (let x = 0; x < 50; x++) {
                    const pixel = document.createElement('div');
                    pixel.className = 'pixel';
                    pixel.dataset.x = x;
                    pixel.dataset.y = y;
                    
                    const country = findCountryForPixel(x, y);
                    if (country && countriesData[country]) {
                        pixel.dataset.country = country;
                        pixel.style.background = countriesData[country].color;
                        
                        if (country === 'latvia') {
                            pixel.classList.add('latvia');
                        }
                        
                        pixel.textContent = getCountryCode(country);
                    } else {
                        pixel.classList.add('empty');
                    }
                    
                    pixel.addEventListener('mouseenter', handlePixelHover);
                    pixel.addEventListener('mouseleave', handlePixelLeave);
                    
                    pixelMap.appendChild(pixel);
                }
            }
            
            addCountryBorders();
            updateStatistics();
            createCountryList();
            updateGameStats();
        }

        function findCountryForPixel(x, y) {
            for (const [country, pixels] of Object.entries(countryPixels)) {
                if (pixels.some(([px, py]) => px === x && py === y)) {
                    return country;
                }
            }
            return null;
        }

        function getCountryCode(countryId) {
            const codes = {
                'latvia': 'LV', 'lithuania': 'LT', 'estonia': 'EE',
                'finland': 'FI', 'norway': 'NO', 'denmark': 'DK', 'iceland': 'IS',
                'france': 'FR', 'germany': 'DE', 'italy': 'IT', 'spain': 'ES',
                'poland': 'PL', 'belarus': 'BY', 'ukraine': 'UA', 'czechia': 'CZ',
                'austria': 'AT', 'hungary': 'HU', 'romania': 'RO', 'bulgaria': 'BG',
                'greece': 'GR', 'croatia': 'HR', 'albania': 'AL',
                'montenegro': 'ME', 'north_macedonia': 'MK',
                'belgium': 'BE', 'netherlands': 'NL', 'portugal': 'PT', 
                'switzerland': 'CH'
            };
            return codes[countryId] || countryId.substring(0, 2).toUpperCase();
        }

        function addCountryBorders() {
            const pixels = document.querySelectorAll('.pixel:not(.empty)');
            
            pixels.forEach(pixel => {
                const x = parseInt(pixel.dataset.x);
                const y = parseInt(pixel.dataset.y);
                const country = pixel.dataset.country;

                const neighbors = [
                    {dx: 0, dy: -1, border: 'top'},
                    {dx: 1, dy: 0, border: 'right'},
                    {dx: 0, dy: 1, border: 'bottom'},
                    {dx: -1, dy: 0, border: 'left'}
                ];

                neighbors.forEach(neighbor => {
                    const nx = x + neighbor.dx;
                    const ny = y + neighbor.dy;
                    
                    if (isValidCoordinate(nx, ny)) {
                        const neighborCountry = findCountryForPixel(nx, ny);
                        if (neighborCountry !== country) {
                            const border = document.createElement('div');
                            border.className = `country-border border-${neighbor.border}`;
                            pixel.appendChild(border);
                        }
                    } else {
                        const border = document.createElement('div');
                        border.className = `country-border border-${neighbor.border}`;
                        pixel.appendChild(border);
                    }
                });
            });
        }

        function isValidCoordinate(x, y) {
            return x >= 0 && x < 50 && y >= 0 && y < 35;
        }

        function updateStatistics() {
            const total = Object.keys(countriesData).length;
            const occupied = Object.values(countriesData).filter(c => c.player !== '–Ω–µ –∑–∞–Ω—è—Ç–æ').length;
            const available = Object.values(countriesData).filter(c => c.player === '–Ω–µ –∑–∞–Ω—è—Ç–æ').length - 1;
            
            const totalElement = document.getElementById('total-countries');
            const occupiedElement = document.getElementById('occupied-countries');
            const availableElement = document.getElementById('available-countries');
            
            if (totalElement) totalElement.textContent = total;
            if (occupiedElement) occupiedElement.textContent = occupied;
            if (availableElement) availableElement.textContent = available;
        }

        function createCountryList() {
            const countryList = document.getElementById('country-list');
            if (!countryList) return;
            
            countryList.innerHTML = '';

            Object.entries(countriesData).forEach(([id, data]) => {
                const item = document.createElement('div');
                item.className = 'country-item';
                item.style.borderLeftColor = data.color;
                item.innerHTML = `
                    <div>
                        <strong>${data.name}</strong>
                        <div class="player-name">${data.player}</div>
                    </div>
                    <div style="font-size: 0.8em; opacity: 0.7;">${getCountryCode(id)}</div>
                `;
                countryList.appendChild(item);
            });
        }

        function handlePixelHover(event) {
            const pixel = event.target;
            const countryId = pixel.dataset.country;
            
            if (countryId && countriesData[countryId]) {
                const country = countriesData[countryId];
                const detailsElement = document.getElementById('region-details');
                
                if (detailsElement) {
                    detailsElement.innerHTML = `
                        <div class="country-name">${country.name}</div>
                        <div class="coordinates">–ò–≥—Ä–æ–∫: ${country.player}</div>
                        <div class="detail-item">
                            <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="detail-value">${
                                countryId === 'latvia' ? '–í–∞—à–∞ —Å—Ç—Ä–∞–Ω–∞' : 
                                country.player !== '–Ω–µ –∑–∞–Ω—è—Ç–æ' ? '–ó–∞–Ω—è—Ç–∞' : '–°–≤–æ–±–æ–¥–Ω–∞'
                            }</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ö–æ–¥:</span>
                            <span class="detail-value">${getCountryCode(countryId)}</span>
                        </div>
                    `;
                }
            }
        }

        function handlePixelLeave(event) {
            const detailsElement = document.getElementById('region-details');
            if (detailsElement) {
                detailsElement.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üß±</div>
                        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</h3>
                        <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ</p>
                    </div>
                `;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —é–Ω–∏—Ç–∞–º–∏ - –° –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ú –°–ú–ï–©–ï–ù–ò–ï–ú –í–õ–ï–í–û
        function renderUnit(unit) {
            let unitElement = document.getElementById(unit.id);
            if (!unitElement) {
                unitElement = document.createElement('div');
                unitElement.id = unit.id;
                document.getElementById('pixel-map').appendChild(unitElement);
            }
            
            unitElement.className = `unit soldier ${unit.isMoving ? 'moving' : ''}`;
            
            // –ü–û–ó–ò–¶–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –°–û –°–ú–ï–©–ï–ù–ò–ï–ú –í–õ–ï–í–û
            const pixelPos = getPixelCoordinates(unit.position.x, unit.position.y);
            const centerOffset = 2.5; // (25 - 20) / 2
            
            unitElement.style.left = (pixelPos.left + centerOffset + LEFT_OFFSET) + 'px';
            unitElement.style.top = (pixelPos.top + centerOffset) + 'px';
            unitElement.style.background = '#3498db';
            unitElement.innerHTML = `üë•<div style="font-size:8px">${unit.size}</div>`;
            
            console.log(`üìç –Æ–Ω–∏—Ç ${unit.id} –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ ${unit.position.x},${unit.position.y} —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º ${LEFT_OFFSET}px`);
        }

        function createGhostUnit(unit) {
            const pixelMap = document.getElementById('pixel-map');
            const ghost = document.createElement('div');
            
            ghost.className = `unit soldier ghost`;
            
            const pixelPos = getPixelCoordinates(unit.position.x, unit.position.y);
            const centerOffset = 2.5;
            
            ghost.style.left = (pixelPos.left + centerOffset + LEFT_OFFSET) + 'px';
            ghost.style.top = (pixelPos.top + centerOffset) + 'px';
            ghost.style.background = '#3498db';
            ghost.innerHTML = `üë•<div style="font-size:8px">${unit.size}</div>`;
            
            pixelMap.appendChild(ghost);
            gameState.ghostUnit = ghost;
        }

        function updateGhostPosition(x, y) {
            if (gameState.ghostUnit) {
                const pixelPos = getPixelCoordinates(x, y);
                const centerOffset = 2.5;
                
                gameState.ghostUnit.style.left = (pixelPos.left + centerOffset + LEFT_OFFSET) + 'px';
                gameState.ghostUnit.style.top = (pixelPos.top + centerOffset) + 'px';
            }
        }

        function showMovementPath(start, end) {
            document.querySelectorAll('.movement-path, .movement-time').forEach(el => el.remove());
            
            const distance = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
            const isCountry = findCountryForPixel(end.x, end.y) !== null;
            const speedMultiplier = isCountry ? 1.0 : 0.5;
            const duration = calculateMoveDuration(distance, speedMultiplier);
            
            const timeElement = document.createElement('div');
            timeElement.className = 'movement-time';
            
            const pixelPos = getPixelCoordinates(end.x, end.y);
            timeElement.style.left = (pixelPos.left + 5 + LEFT_OFFSET) + 'px';
            timeElement.style.top = (pixelPos.top - 15) + 'px';
            timeElement.textContent = formatDuration(duration);
            
            document.getElementById('pixel-map').appendChild(timeElement);
        }

        function calculateMoveDuration(distance, speedMultiplier) {
            const baseSecondsPerPixel = 2;
            return Math.round(distance * baseSecondsPerPixel * speedMultiplier);
        }

        function formatDuration(seconds) {
            if (seconds < 60) {
                return `${seconds}—Å–µ–∫`;
            } else {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}–º ${remainingSeconds}—Å–µ–∫`;
            }
        }

        function moveUnit(unit, targetPos) {
            console.log('moveUnit –í–•–û–î:', {targetPos});
            
            if (unit.position.x === targetPos.x && unit.position.y === targetPos.y) {
                console.log('–û–®–ò–ë–ö–ê: –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä–∞–≤–Ω–∞ —Ç–µ–∫—É—â–µ–π');
                return;
            }
            
            const distance = Math.sqrt(Math.pow(targetPos.x - unit.position.x, 2) + Math.pow(targetPos.y - unit.position.y, 2));
            const isCountry = findCountryForPixel(targetPos.x, targetPos.y) !== null;
            const speedMultiplier = isCountry ? 1.0 : 0.5;
            const duration = calculateMoveDuration(distance, speedMultiplier);
            
            unit.isMoving = true;
            unit.targetPosition = targetPos;
            unit.moveStartTime = Date.now();
            unit.moveDuration = duration * 1000;
            
            console.log(`–ê—Ä–º–∏—è ${unit.id} –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ –∏–∑ ${unit.position.x},${unit.position.y} –≤ ${targetPos.x},${targetPos.y} –∑–∞ ${duration}—Å–µ–∫`);
            
            saveToDatabase('units/' + unit.id, unit);
            
            const unitElement = document.getElementById(unit.id);
            if (unitElement) {
                unitElement.classList.add('moving');
            }
            
            startMovementAnimation(unit);
        }

        function startMovementAnimation(unit) {
            const unitElement = document.getElementById(unit.id);
            if (!unitElement) return;
            
            const startTime = Date.now();
            const startPos = {...unit.position};
            const targetPos = unit.targetPosition;
            
            function animateMove() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / unit.moveDuration, 1);
                
                if (progress < 1) {
                    const currentX = startPos.x + (targetPos.x - startPos.x) * progress;
                    const currentY = startPos.y + (targetPos.y - startPos.y) * progress;
                    
                    const pixelPos = getPixelCoordinates(currentX, currentY);
                    const centerOffset = 2.5;
                    
                    unitElement.style.left = (pixelPos.left + centerOffset + LEFT_OFFSET) + 'px';
                    unitElement.style.top = (pixelPos.top + centerOffset) + 'px';
                    
                    requestAnimationFrame(animateMove);
                } else {
                    unit.isMoving = false;
                    unit.position = targetPos;
                    unit.targetPosition = null;
                    
                    if (unitElement) {
                        unitElement.classList.remove('moving');
                        const finalPixelPos = getPixelCoordinates(targetPos.x, targetPos.y);
                        const centerOffset = 2.5;
                        unitElement.style.left = (finalPixelPos.left + centerOffset + LEFT_OFFSET) + 'px';
                        unitElement.style.top = (finalPixelPos.top + centerOffset) + 'px';
                    }
                    
                    checkForCapture(unit);
                    updateGameStats();
                    saveToDatabase('units/' + unit.id, unit);
                    
                    console.log(`‚úÖ –ê—Ä–º–∏—è ${unit.id} –ø—Ä–∏–±—ã–ª–∞ –≤ ${targetPos.x},${targetPos.y}`);
                }
            }
            
            animateMove();
        }

        function checkForCapture(unit) {
            const country = findCountryForPixel(unit.position.x, unit.position.y);
            console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞: –∞—Ä–º–∏—è –Ω–∞ ${unit.position.x},${unit.position.y}, —Å—Ç—Ä–∞–Ω–∞: ${country}`);
            
            if (country && country !== 'latvia') {
                const territoryKey = `${unit.position.x},${unit.position.y}`;
                gameState.territories[territoryKey] = {
                    originalCountry: country,
                    capturedBy: unit.owner,
                    unitId: unit.id,
                    timestamp: Date.now()
                };

                const pixel = document.querySelector(`.pixel[data-x="${unit.position.x}"][data-y="${unit.position.y}"]`);
                if (pixel) {
                    pixel.classList.add('captured-territory');
                    pixel.title = `–ó–∞—Ö–≤–∞—á–µ–Ω–æ –õ–∞—Ç–≤–∏–µ–π\n–ê—Ä–º–∏—è: ${unit.size} —Å–æ–ª–¥–∞—Ç`;
                    console.log(`‚úÖ –ó–∞—Ö–≤–∞—á–µ–Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è ${territoryKey} —É ${country}`);
                }

                updateGameStats();
                saveToDatabase('territories/' + territoryKey, gameState.territories[territoryKey]);
            }
        }

        function cleanupDrag() {
            if (gameState.ghostUnit) {
                gameState.ghostUnit.remove();
                gameState.ghostUnit = null;
            }
            
            document.querySelectorAll('.movement-path, .movement-time').forEach(el => el.remove());
            
            if (gameState.selectedUnit) {
                const unitElement = document.getElementById(gameState.selectedUnit.id);
                if (unitElement) {
                    unitElement.classList.remove('dragging');
                }
                gameState.selectedUnit = null;
            }
        }

        function updateGameStats() {
            const playerUnits = gameState.units.filter(u => u.owner === gameState.playerId).length;
            const captured = Object.keys(gameState.territories).length;
            const totalSoldiers = gameState.units
                .filter(u => u.owner === gameState.playerId)
                .reduce((sum, unit) => sum + unit.size, 0);
            const movingUnits = gameState.units.filter(u => u.isMoving).length;
            
            document.getElementById('total-units').textContent = playerUnits;
            document.getElementById('captured-territories').textContent = captured;
            document.getElementById('total-soldiers').textContent = totalSoldiers;
            document.getElementById('moving-units').textContent = movingUnits;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        function loadGameData() {
            loadFromDatabase('units', (units) => {
                if (units) {
                    gameState.units = Object.values(units);
                    gameState.units.forEach(unit => {
                        renderUnit(unit);
                        setupUnitClick(unit);
                    });
                    updateGameStats();
                }
            });

            loadFromDatabase('territories', (territories) => {
                if (territories) {
                    gameState.territories = territories;
                    updateCapturedTerritories();
                }
            });
        }

        function updateCapturedTerritories() {
            Object.keys(gameState.territories).forEach(coord => {
                const [x, y] = coord.split(',').map(Number);
                const pixel = document.querySelector(`.pixel[data-x="${x}"][data-y="${y}"]`);
                if (pixel) {
                    pixel.classList.add('captured-territory');
                }
            });
            updateGameStats();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initialize() {
            createPixelMap();
            loadGameData();
            
            setTimeout(() => {
                if (gameState.units.length === 0) {
                    createArmy(500);
                    createArmy(1000);
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', initialize);

        document.getElementById('pixel-map').addEventListener('click', (e) => {
            if (gameState.radialMenu.active && !e.target.closest('.radial-menu')) {
                closeRadialMenu();
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–ª–±–∞–Ω–∏—è</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    .country { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    button { margin: 5px; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { opacity: 0.8; }
    #messages { margin-top: 20px; padding: 10px; background: #eee; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="country">
    <h2>–ê–ª–±–∞–Ω–∏—è</h2>
    <p>–ù–∞—Å–µ–ª–µ–Ω–∏–µ: <span id="population">0</span></p>
    <p>–ê—Ä–º–∏—è: <span id="army">0</span></p>
    <p>–ó–æ–ª–æ—Ç–æ: <span id="gold">0</span></p>
    <p>–î–æ—Ö–æ–¥: <span id="income">0</span></p>
    <p>–ê–ª—å—è–Ω—Å: <span id="alliance">–Ω–µ—Ç</span></p>

    <button onclick="createAlliance()">–°–æ–∑–¥–∞—Ç—å –∞–ª—å—è–Ω—Å</button>
    <button onclick="leaveAlliance()">–í—ã–π—Ç–∏ –∏–∑ –∞–ª—å—è–Ω—Å–∞</button>
    <button onclick="declareWar()">–û–±—ä—è–≤–∏—Ç—å –≤–æ–π–Ω—É</button>
  </div>

  <div id="messages">
    <h3>–°–æ–æ–±—â–µ–Ω–∏—è</h3>
    <ul id="messageList"></ul>
  </div>

<script type="module">
  // üîπ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDRUoIzXpwwAGYM0qciAYdQm-wtMKqLsVs",
    authDomain: "strani3.firebaseapp.com",
    projectId: "strani3",
    storageBucket: "strani3.firebasestorage.app",
    messagingSenderId: "225168183800",
    appId: "1:225168183800:web:825e782a35bccca89d460d",
    measurementId: "G-3NKBET5R9J",
    databaseURL: "https://strani3-default-rtdb.firebaseio.com/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const countryName = "–ê–ª–±–∞–Ω–∏—è";

  // üîπ –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω—ã –µ—â—ë –Ω–µ—Ç –≤ –±–∞–∑–µ)
  async function initCountry() {
    const countryRef = ref(db, 'countries/' + countryName);
    const snap = await get(countryRef);
    if (!snap.exists()) {
      set(countryRef, {
        population: 2000000,
        army: 10,
        gold: 10,
        income: 0,
        alliance: "–Ω–µ—Ç",
        isLeader: false
      });
    }
  }

  // üîπ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  function updateUI(data) {
    document.getElementById("population").innerText = data.population;
    document.getElementById("army").innerText = data.army;
    document.getElementById("gold").innerText = data.gold;
    document.getElementById("income").innerText = data.income;
    document.getElementById("alliance").innerText = data.alliance || "–Ω–µ—Ç";
  }

  // üîπ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã
  function listenCountry() {
    const countryRef = ref(db, 'countries/' + countryName);
    onValue(countryRef, (snapshot) => {
      if (snapshot.exists()) {
        updateUI(snapshot.val());
      }
    });
  }

  // üîπ –°–æ–∑–¥–∞—Ç—å –∞–ª—å—è–Ω—Å
  function createAlliance() {
    let name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–ª—å—è–Ω—Å–∞:");
    if (name) {
      update(ref(db, 'countries/' + countryName), {
        alliance: name,
        isLeader: true
      });
      addMessage(countryName + " —Å–æ–∑–¥–∞–ª–∞ –∞–ª—å—è–Ω—Å '" + name + "'");
    }
  }

  // üîπ –í—ã–π—Ç–∏ –∏–∑ –∞–ª—å—è–Ω—Å–∞
  function leaveAlliance() {
    update(ref(db, 'countries/' + countryName), {
      alliance: "–Ω–µ—Ç",
      isLeader: false
    });
    addMessage(countryName + " –≤—ã—à–ª–∞ –∏–∑ –∞–ª—å—è–Ω—Å–∞");
  }

  // üîπ –û–±—ä—è–≤–∏—Ç—å –≤–æ–π–Ω—É
  function declareWar() {
    let enemy = prompt("–ö–æ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—ä—è–≤–∏—Ç—å –≤–æ–π–Ω—É?");
    if (enemy) {
      addMessage(countryName + " –æ–±—ä—è–≤–∏–ª–∞ –≤–æ–π–Ω—É " + enemy);
      // üì© –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏—Å—å–º–æ –≤—Ä–∞–≥—É
      push(ref(db, 'messages/' + enemy), {
        text: countryName + " –æ–±—ä—è–≤–ª—è–µ—Ç –≤–∞–º –≤–æ–π–Ω—É! –£ –≤–∞—Å –µ—Å—Ç—å –¥–µ–Ω—å –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É.",
        time: Date.now()
      });
    }
  }

  // üîπ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  function addMessage(text) {
    const msgList = document.getElementById("messageList");
    let li = document.createElement("li");
    li.textContent = text;
    msgList.appendChild(li);

    push(ref(db, 'messages/' + countryName), {
      text: text,
      time: Date.now()
    });
  }

  // üîπ –°–ª—É—à–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ –ø–∏—Å—å–º–∞
  function listenMessages() {
    const msgRef = ref(db, 'messages/' + countryName);
    onValue(msgRef, (snapshot) => {
      const msgList = document.getElementById("messageList");
      msgList.innerHTML = "";
      snapshot.forEach(child => {
        let li = document.createElement("li");
        li.textContent = child.val().text;
        msgList.appendChild(li);
      });
    });
  }

  // üîπ –ó–∞–ø—É—Å–∫
  initCountry().then(() => {
    listenCountry();
    listenMessages();
  });
</script>
</body>
</html>

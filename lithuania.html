<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Литва</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDRUoIzXpwwAGYM0qciAYdQm-wtMKqLsVs",
  authDomain: "strani3.firebaseapp.com",
  projectId: "strani3",
  storageBucket: "strani3.firebasestorage.app",
  messagingSenderId: "225168183800",
  appId: "1:225168183800:web:825e782a35bccca89d460d",
  measurementId: "G-3NKBET5R9J"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const countryId = "lithuania";

// Загрузка статистики
async function loadStats() {
  const ref = doc(db, "countries", countryId);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    const data = snap.data();
    document.getElementById("money").textContent = data.money ?? 0;
    document.getElementById("army").textContent = data.army ?? 0;
    document.getElementById("income").textContent = data.income ?? 0;
    document.getElementById("alliance").textContent = data.alliance ?? "нет";
  } else {
    await setDoc(ref, { money: 0, army: 0, income: 0, alliance: "нет" });
    loadStats();
  }
}

// Создать альянс
async function createAlliance() {
  const name = prompt("Введите название альянса:");
  if (!name) return;

  const ref = doc(db, "countries", countryId);
  await updateDoc(ref, { alliance: name });
  alert("Альянс создан: " + name);
  loadStats();
}

// Выйти из альянса
async function leaveAlliance() {
  const ref = doc(db, "countries", countryId);
  await updateDoc(ref, { alliance: "нет" });
  alert("Вы вышли из альянса");
  loadStats();
}

// Выкинуть страну из альянса
async function kickFromAlliance() {
  const target = prompt("Введите страну, которую хотите выгнать:");
  if (!target) return;

  const ref = doc(db, "countries", target);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    await updateDoc(ref, { alliance: "нет" });
    alert("Страна " + target + " исключена из альянса");
  } else {
    alert("Такой страны нет в базе");
  }
}

// Объявить войну
async function declareWar() {
  const enemy = prompt("Введите страну, которой хотите объявить войну:");
  if (!enemy) return;

  await addDoc(collection(db, "messages"), {
    to: enemy,
    from: countryId,
    type: "war",
    text: `Страна ${countryId} объявляет вам войну!`,
    date: new Date().toISOString()
  });

  alert("Война объявлена стране: " + enemy);
}

// Загрузить почту
async function loadMessages() {
  const q = query(collection(db, "messages"), where("to", "==", countryId));
  const snaps = await getDocs(q);

  const box = document.getElementById("mail");
  box.innerHTML = "<h3>Почта</h3>";

  snaps.forEach(docSnap => {
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "mailItem";
    div.textContent = `[${data.type}] ${data.text}`;
    box.appendChild(div);
  });
}

window.onload = () => {
  loadStats();
  loadMessages();

  document.getElementById("btnAlliance").onclick = createAlliance;
  document.getElementById("btnWar").onclick = declareWar;
  document.getElementById("btnLeave").onclick = leaveAlliance;
  document.getElementById("btnKick").onclick = kickFromAlliance;

  // автообновление раз в 10 секунд
  setInterval(() => {
    loadStats();
    loadMessages();
  }, 10000);
};
</script>
<style>
body { background:#111; color:#eee; font-family:Arial; padding:20px; }
h1 { text-align:center; }
.stats { background:#2a2a2a; padding:15px; border-radius:10px; max-width:500px; margin:auto; }
.stats div { margin:5px 0; }
button { padding:8px 12px; border:none; border-radius:5px; background:#4caf50; color:#fff; cursor:pointer; margin:5px; }
button:hover { background:#45a049; }
.mail { background:#222; margin-top:20px; padding:10px; border-radius:8px; max-width:500px; margin:auto; }
.mailItem { background:#333; padding:8px; border-radius:5px; margin-bottom:6px; }
</style>
</head>
<body>
<h1>Литва</h1>
<div class="stats">
  <div>Деньги: <span id="money">00</span></div>
  <div>Армия: <span id="army">00</span></div>
  <div>Доход: <span id="income">00</span></div>
  <div>Альянс: <span id="alliance">нет</span></div>
</div>

<div style="text-align:center; margin-top:15px;">
  <button id="btnAlliance">Создать альянс</button>
  <button id="btnLeave">Выйти из альянса</button>
  <button id="btnKick">Выкинуть из альянса</button>
  <button id="btnWar">Объявить войну</button>
</div>

<div id="mail" class="mail">
  <h3>Почта</h3>
</div>
</body>
</html>

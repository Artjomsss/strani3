<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã - –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #2a2a40);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .map-container {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .europe-map {
            width: 100%;
            height: 700px;
            background: #2a2a40;
            border: 2px solid #3a3a5a;
            border-radius: 10px;
        }

        .country {
            cursor: pointer;
            transition: all 0.3s ease;
            stroke: #fff;
            stroke-width: 1;
        }

        .country:hover {
            stroke-width: 3;
            stroke: #3498db;
            filter: brightness(1.2);
        }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .control-group {
            margin-bottom: 25px;
        }

        h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h3 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .legend {
            display: grid;
            grid-template-columns: 20px 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #fff;
        }

        .status-info {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .country-details {
            background: rgba(39, 174, 96, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #27ae60;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-label {
            font-weight: bold;
            color: #ccc;
        }

        .detail-value {
            color: #fff;
        }

        .debug-info {
            background: rgba(231, 76, 60, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #e74c3c;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
        }

        .no-data {
            background: rgba(243, 156, 18, 0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #f39c12;
        }

        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            background: rgba(52, 152, 219, 0.3);
            border: 1px solid #3498db;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: rgba(52, 152, 219, 0.5);
        }

        .filter-btn.active {
            background: #3498db;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .updating {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç –ö–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã - –ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è</h1>
            <div class="subtitle">–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è ‚Ä¢ –î–∞–Ω–Ω—ã–µ –∏–∑ Firebase ‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</div>
        </header>

        <div class="content">
            <div class="map-container">
                <div class="filters">
                    <button class="filter-btn active" onclick="setFilter('all')">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</button>
                    <button class="filter-btn" onclick="setFilter('wars')">–¢–æ–ª—å–∫–æ —Å –≤–æ–π–Ω–∞–º–∏</button>
                </div>
                <svg class="europe-map" viewBox="0 0 1000 800" id="europe-map">
                    <!-- –ê–ª–±–∞–Ω–∏—è -->
                    <path id="albania" class="country" d="M550,500 L560,490 L570,500 L565,510 L555,505 Z" 
                          data-country="albania" fill="#3498db"/>
                    
                    <!-- –ê–Ω–¥–æ—Ä—Ä–∞ -->
                    <path id="andorra" class="country" d="M400,450 L410,440 L420,450 L415,460 L405,455 Z" 
                          data-country="andorra" fill="#3498db"/>
                    
                    <!-- –ê–≤—Å—Ç—Ä–∏—è -->
                    <path id="austria" class="country" d="M500,400 L520,390 L530,400 L525,410 L510,405 Z" 
                          data-country="austria" fill="#3498db"/>
                    
                    <!-- –ë–µ–ª–∞—Ä—É—Å—å -->
                    <path id="belarus" class="country" d="M600,350 L630,340 L640,360 L620,370 L610,355 Z" 
                          data-country="belarus" fill="#3498db"/>
                    
                    <!-- –ë–µ–ª—å–≥–∏—è -->
                    <path id="belgium" class="country" d="M420,380 L440,370 L450,385 L435,395 L425,385 Z" 
                          data-country="belgium" fill="#3498db"/>
                    
                    <!-- –ë–æ–ª–≥–∞—Ä–∏—è -->
                    <path id="bulgaria" class="country" d="M580,450 L600,440 L610,460 L590,470 L580,455 Z" 
                          data-country="bulgaria" fill="#3498db"/>
                    
                    <!-- –•–æ—Ä–≤–∞—Ç–∏—è -->
                    <path id="croatia" class="country" d="M520,430 L540,420 L545,435 L530,445 L525,435 Z" 
                          data-country="croatia" fill="#3498db"/>
                    
                    <!-- –ß–µ—Ö–∏—è -->
                    <path id="czechia" class="country" d="M520,380 L540,370 L545,385 L530,395 L525,385 Z" 
                          data-country="czechia" fill="#3498db"/>
                    
                    <!-- –î–∞–Ω–∏—è -->
                    <path id="denmark" class="country" d="M470,330 L490,320 L495,335 L480,345 L475,335 Z" 
                          data-country="denmark" fill="#3498db"/>
                    
                    <!-- –≠—Å—Ç–æ–Ω–∏—è -->
                    <path id="estonia" class="country" d="M580,300 L600,290 L605,310 L585,320 L580,305 Z" 
                          data-country="estonia" fill="#3498db"/>
                    
                    <!-- –§–∏–Ω–ª—è–Ω–¥–∏—è -->
                    <path id="finland" class="country" d="M550,250 L590,240 L600,270 L570,280 L555,260 Z" 
                          data-country="finland" fill="#3498db"/>
                    
                    <!-- –§—Ä–∞–Ω—Ü–∏—è -->
                    <path id="france" class="country" d="M380,400 L430,380 L440,420 L400,440 L385,410 Z" 
                          data-country="france" fill="#3498db"/>
                    
                    <!-- –ì–µ—Ä–º–∞–Ω–∏—è -->
                    <path id="germany" class="country" d="M470,370 L510,360 L520,390 L480,400 L475,380 Z" 
                          data-country="germany" fill="#3498db"/>
                    
                    <!-- –ì—Ä–µ—Ü–∏—è -->
                    <path id="greece" class="country" d="M570,480 L590,470 L595,490 L575,500 L570,485 Z" 
                          data-country="greece" fill="#3498db"/>
                    
                    <!-- –í–µ–Ω–≥—Ä–∏—è -->
                    <path id="hungary" class="country" d="M540,420 L560,410 L565,430 L545,440 L540,425 Z" 
                          data-country="hungary" fill="#3498db"/>
                    
                    <!-- –ò—Å–ª–∞–Ω–¥–∏—è -->
                    <path id="iceland" class="country" d="M300,200 L340,190 L345,220 L310,230 L305,210 Z" 
                          data-country="iceland" fill="#3498db"/>
                    
                    <!-- –ò—Ä–ª–∞–Ω–¥–∏—è -->
                    <path id="ireland" class="country" d="M320,350 L360,340 L365,370 L330,380 L325,360 Z" 
                          data-country="ireland" fill="#3498db"/>
                    
                    <!-- –ò—Ç–∞–ª–∏—è -->
                    <path id="italy" class="country" d="M480,460 L520,450 L525,480 L490,490 L485,470 Z" 
                          data-country="italy" fill="#3498db"/>
                    
                    <!-- –õ–∞—Ç–≤–∏—è -->
                    <path id="latvia" class="country" d="M580,330 L600,320 L605,340 L585,350 L580,335 Z" 
                          data-country="latvia" fill="#3498db"/>
                    
                    <!-- –õ–∏—Ç–≤–∞ -->
                    <path id="lithuania" class="country" d="M570,350 L590,340 L595,360 L575,370 L570,355 Z" 
                          data-country="lithuania" fill="#3498db"/>
                    
                    <!-- –õ—é–∫—Å–µ–º–±—É—Ä–≥ -->
                    <path id="luxembourg" class="country" d="M440,390 L450,385 L455,395 L445,400 L442,392 Z" 
                          data-country="luxembourg" fill="#3498db"/>
                    
                    <!-- –ú–∞–ª—å—Ç–∞ -->
                    <path id="malta" class="country" d="M520,520 L530,515 L535,525 L525,530 Z" 
                          data-country="malta" fill="#3498db"/>
                    
                    <!-- –ú–æ–ª–¥–æ–≤–∞ -->
                    <path id="moldova" class="country" d="M620,420 L640,410 L645,430 L625,440 L620,425 Z" 
                          data-country="moldova" fill="#3498db"/>
                    
                    <!-- –ú–æ–Ω–∞–∫–æ -->
                    <path id="monaco" class="country" d="M460,440 L465,438 L468,445 L463,447 Z" 
                          data-country="monaco" fill="#3498db"/>
                    
                    <!-- –ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è -->
                    <path id="montenegro" class="country" d="M550,470 L560,465 L565,475 L555,480 Z" 
                          data-country="montenegro" fill="#3498db"/>
                    
                    <!-- –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã -->
                    <path id="netherlands" class="country" d="M440,360 L460,350 L465,370 L445,380 L442,365 Z" 
                          data-country="netherlands" fill="#3498db"/>
                    
                    <!-- –°–µ–≤–µ—Ä–Ω–∞—è –ú–∞–∫–µ–¥–æ–Ω–∏—è -->
                    <path id="north_macedonia" class="country" d="M570,460 L580,455 L585,465 L575,470 Z" 
                          data-country="north_macedonia" fill="#3498db"/>
                    
                    <!-- –ù–æ—Ä–≤–µ–≥–∏—è -->
                    <path id="norway" class="country" d="M480,280 L530,270 L540,310 L500,320 L485,290 Z" 
                          data-country="norway" fill="#3498db"/>
                    
                    <!-- –ü–æ–ª—å—à–∞ -->
                    <path id="poland" class="country" d="M540,370 L580,360 L585,390 L550,400 L545,375 Z" 
                          data-country="poland" fill="#3498db"/>
                    
                    <!-- –ü–æ—Ä—Ç—É–≥–∞–ª–∏—è -->
                    <path id="portugal" class="country" d="M320,450 L360,440 L365,470 L330,480 L325,460 Z" 
                          data-country="portugal" fill="#3498db"/>
                    
                    <!-- –ü–æ–¥–ø–∏—Å–∏ —Å—Ç—Ä–∞–Ω -->
                    <text x="555" y="505" font-size="8" fill="white" text-anchor="middle">AL</text>
                    <text x="415" y="455" font-size="8" fill="white" text-anchor="middle">AD</text>
                    <text x="525" y="405" font-size="8" fill="white" text-anchor="middle">AT</text>
                    <text x="625" y="360" font-size="8" fill="white" text-anchor="middle">BY</text>
                    <text x="435" y="390" font-size="8" fill="white" text-anchor="middle">BE</text>
                    <text x="595" y="465" font-size="8" fill="white" text-anchor="middle">BG</text>
                    <text x="535" y="440" font-size="8" fill="white" text-anchor="middle">HR</text>
                    <text x="535" y="390" font-size="8" fill="white" text-anchor="middle">CZ</text>
                    <text x="485" y="340" font-size="8" fill="white" text-anchor="middle">DK</text>
                    <text x="595" y="315" font-size="8" fill="white" text-anchor="middle">EE</text>
                    <text x="575" y="270" font-size="8" fill="white" text-anchor="middle">FI</text>
                    <text x="410" y="420" font-size="8" fill="white" text-anchor="middle">FR</text>
                    <text x="490" y="385" font-size="8" fill="white" text-anchor="middle">DE</text>
                    <text x="585" y="495" font-size="8" fill="white" text-anchor="middle">GR</text>
                    <text x="555" y="435" font-size="8" fill="white" text-anchor="middle">HU</text>
                    <text x="325" y="220" font-size="8" fill="white" text-anchor="middle">IS</text>
                    <text x="345" y="375" font-size="8" fill="white" text-anchor="middle">IE</text>
                    <text x="505" y="480" font-size="8" fill="white" text-anchor="middle">IT</text>
                    <text x="595" y="345" font-size="8" fill="white" text-anchor="middle">LV</text>
                    <text x="585" y="365" font-size="8" fill="white" text-anchor="middle">LT</text>
                    <text x="448" y="395" font-size="6" fill="white" text-anchor="middle">LU</text>
                    <text x="530" y="528" font-size="6" fill="white" text-anchor="middle">MT</text>
                    <text x="635" y="435" font-size="8" fill="white" text-anchor="middle">MD</text>
                    <text x="463" y="445" font-size="6" fill="white" text-anchor="middle">MC</text>
                    <text x="560" y="478" font-size="6" fill="white" text-anchor="middle">ME</text>
                    <text x="455" y="375" font-size="8" fill="white" text-anchor="middle">NL</text>
                    <text x="578" y="468" font-size="6" fill="white" text-anchor="middle">MK</text>
                    <text x="510" y="305" font-size="8" fill="white" text-anchor="middle">NO</text>
                    <text x="565" y="385" font-size="8" fill="white" text-anchor="middle">PL</text>
                    <text x="345" y="475" font-size="8" fill="white" text-anchor="middle">PT</text>
                </svg>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h2>üéØ –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã</h2>
                    <div class="legend">
                        <div class="color-box" style="background-color: #27ae60;"></div>
                        <span>–ú–∏—Ä–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞ (–Ω–µ—Ç –≤–æ–π–Ω)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #e74c3c;"></div>
                        <span>–£—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤–æ–π–Ω–µ</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #3498db;"></div>
                        <span>–í –∞–ª—å—è–Ω—Å–µ</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #f39c12;"></div>
                        <span>–í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥ (>50/—á–∞—Å)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #9b59b6;"></div>
                        <span>–ë–æ–ª—å—à–∞—è –∞—Ä–º–∏—è (>500)</span>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
                    <div class="status-info">
                        <div class="detail-item">
                            <span class="detail-label">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</span>
                            <span class="detail-value" id="sync-status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–°—Ç—Ä–∞–Ω –∑–∞–≥—Ä—É–∂–µ–Ω–æ:</span>
                            <span class="detail-value" id="countries-count">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–π–Ω:</span>
                            <span class="detail-value" id="wars-count">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ê–ª—å—è–Ω—Å–æ–≤:</span>
                            <span class="detail-value" id="alliances-count">0</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–µ</h2>
                    <div class="country-details" id="country-details">
                        <div class="no-data">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ</div>
                    </div>
                </div>

                <div class="control-group">
                    <h2>‚öôÔ∏è –û—Ç–ª–∞–¥–∫–∞</h2>
                    <div class="debug-info" id="debug-info">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDRUoIzXpwwAGYM0qciAYdQm-wtMKqLsVs",
            authDomain: "strani3.firebaseapp.com",
            databaseURL: "https://strani3-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "strani3",
            storageBucket: "strani3.firebasestorage.app",
            messagingSenderId: "225168183800",
            appId: "1:225168183800:web:825e782a35bccca89d460d",
            measurementId: "G-3NKBET5R9J"
        };

        let db;
        let countriesData = {};
        let currentFilter = 'all';
        let selectedCountry = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        function initializeFirebase() {
            try {
                const app = firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                updateDebugInfo("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                return true;
            } catch (error) {
                updateDebugInfo("‚ùå –û—à–∏–±–∫–∞ Firebase: " + error.message);
                return false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateDebugInfo(message) {
            const debugElement = document.getElementById('debug-info');
            debugElement.innerHTML = message;
            console.log(message);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
        function loadCountriesData() {
            if (!db) {
                updateDebugInfo("‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
                return;
            }

            updateDebugInfo("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω...");
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
            db.ref("countries").on("value", (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    countriesData = data;
                    updateDebugInfo(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${Object.keys(data).length} —Å—Ç—Ä–∞–Ω`);
                    updateMapColors();
                    updateStatistics();
                } else {
                    updateDebugInfo("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
                }
            }, (error) => {
                updateDebugInfo("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + error.message);
            });

            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–æ–π–Ω–∞—Ö
            db.ref("wars").on("value", (snapshot) => {
                const wars = snapshot.val();
                updateStatistics();
                updateMapColors();
            });

            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞–ª—å—è–Ω—Å–∞—Ö
            db.ref("alliances").on("value", (snapshot) => {
                const alliances = snapshot.val();
                updateStatistics();
                updateMapColors();
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatistics() {
            const countriesCount = Object.keys(countriesData).length;
            const wars = document.getElementById('wars-count');
            const alliances = document.getElementById('alliances-count');
            const countries = document.getElementById('countries-count');
            const syncStatus = document.getElementById('sync-status');

            countries.textContent = countriesCount;
            syncStatus.textContent = '‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
            syncStatus.style.color = '#27ae60';

            // –ü–æ–¥—Å—á–µ—Ç –≤–æ–π–Ω –∏ –∞–ª—å—è–Ω—Å–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            wars.textContent = '0';
            alliances.textContent = '0';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
        function updateMapColors() {
            const countries = document.querySelectorAll('.country');
            
            countries.forEach(countryElement => {
                const countryId = countryElement.getAttribute('data-country');
                const countryData = countriesData[countryId];
                
                if (!countryData) {
                    countryElement.style.fill = '#7f8c8d'; // –°–µ—Ä—ã–π –¥–ª—è —Å—Ç—Ä–∞–Ω –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
                    return;
                }

                let color = '#3498db'; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–Ω–∏–π

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—á–∞—Å—Ç–∏–µ –≤ –≤–æ–π–Ω–∞—Ö
                if (countryData.wars && Object.keys(countryData.wars).length > 0) {
                    color = '#e74c3c'; // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –≤–æ–π–Ω—ã
                }
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–ª—å—è–Ω—Å
                else if (countryData.alliance) {
                    color = '#3498db'; // –°–∏–Ω–∏–π –¥–ª—è –∞–ª—å—è–Ω—Å–∞
                }
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥
                else if (countryData.population && (countryData.population / 100000) > 50) {
                    color = '#f39c12'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –¥–æ—Ö–æ–¥–∞
                }
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–æ–ª—å—à—É—é –∞—Ä–º–∏—é
                else if (countryData.army && countryData.army > 500) {
                    color = '#9b59b6'; // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è –±–æ–ª—å—à–æ–π –∞—Ä–º–∏–∏
                }
                // –ú–∏—Ä–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞
                else {
                    color = '#27ae60'; // –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –º–∏—Ä–Ω—ã—Ö
                }

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
                if (currentFilter === 'wars' && color !== '#e74c3c') {
                    countryElement.style.opacity = '0.3';
                } else {
                    countryElement.style.opacity = '1';
                }

                countryElement.style.fill = color;
                countryElement.classList.add('updating');
                
                // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
                setTimeout(() => {
                    countryElement.classList.remove('updating');
                }, 300);
            });
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞
        function setFilter(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateMapColors();
        }

        // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç—Ä–∞–Ω–µ
        function showCountryInfo(countryId) {
            const countryData = countriesData[countryId];
            const detailsElement = document.getElementById('country-details');
            
            if (!countryData) {
                detailsElement.innerHTML = `
                    <div class="no-data">
                        <h3>${countryId.toUpperCase()}</h3>
                        <p>–î–∞–Ω–Ω—ã–µ –ø–æ —Å—Ç—Ä–∞–Ω–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –±–∞–∑–µ</p>
                    </div>
                `;
                return;
            }

            const population = countryData.population || 0;
            const income = Math.floor(population / 100000);
            const army = countryData.army || 0;
            const gold = countryData.gold || 0;
            const alliance = countryData.alliance ? '–î–∞' : '–ù–µ—Ç';
            const wars = countryData.wars ? Object.keys(countryData.wars).length : 0;

            detailsElement.innerHTML = `
                <h3>${countryId.toUpperCase()}</h3>
                <div class="detail-item">
                    <span class="detail-label">–ù–∞—Å–µ–ª–µ–Ω–∏–µ:</span>
                    <span class="detail-value">${population.toLocaleString()}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–î–æ—Ö–æ–¥/—á–∞—Å:</span>
                    <span class="detail-value">${income} –∑–æ–ª–æ—Ç–∞</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ê—Ä–º–∏—è:</span>
                    <span class="detail-value">${army} —Å–æ–ª–¥–∞—Ç</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ó–æ–ª–æ—Ç–æ:</span>
                    <span class="detail-value">${gold}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–í –∞–ª—å—è–Ω—Å–µ:</span>
                    <span class="detail-value">${alliance}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–π–Ω:</span>
                    <span class="detail-value">${wars}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</span>
                    <span class="detail-value">${new Date(countryData.lastUpdated || Date.now()).toLocaleString()}</span>
                </div>
            `;

            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω—É
            if (selectedCountry) {
                selectedCountry.style.strokeWidth = '1';
            }
            selectedCountry = document.getElementById(countryId);
            selectedCountry.style.strokeWidth = '4';
            selectedCountry.style.stroke = '#f39c12';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initializeMap() {
            const countries = document.querySelectorAll('.country');
            
            countries.forEach(country => {
                country.addEventListener('click', (e) => {
                    const countryId = e.target.getAttribute('data-country');
                    showCountryInfo(countryId);
                });

                country.addEventListener('mouseenter', (e) => {
                    const countryId = e.target.getAttribute('data-country');
                    e.target.style.strokeWidth = '3';
                    e.target.style.stroke = '#3498db';
                });

                country.addEventListener('mouseleave', (e) => {
                    if (e.target !== selectedCountry) {
                        e.target.style.strokeWidth = '1';
                        e.target.style.stroke = '#fff';
                    }
                });
            });
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initialize() {
            if (initializeFirebase()) {
                loadCountriesData();
                initializeMap();
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                setInterval(() => {
                    updateMapColors();
                    updateStatistics();
                }, 30000);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>

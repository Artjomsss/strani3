<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã - –†–µ–≥–∏–æ–Ω—ã</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #2a2a40);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .map-container {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .europe-map {
            width: 100%;
            height: 700px;
            background: #2a2a40;
            border: 2px solid #3a3a5a;
            border-radius: 10px;
        }

        .region {
            cursor: pointer;
            transition: all 0.3s ease;
            stroke: #fff;
            stroke-width: 1;
            fill: #3498db;
        }

        .region:hover {
            stroke-width: 3;
            stroke: #3498db;
            filter: brightness(1.2);
        }

        .region-label {
            pointer-events: none;
            font-size: 10px;
            fill: white;
            text-anchor: middle;
            font-weight: bold;
        }

        .controls {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .control-group {
            margin-bottom: 25px;
        }

        h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h3 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .legend {
            display: grid;
            grid-template-columns: 20px 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #fff;
        }

        .status-info {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .region-details {
            background: rgba(39, 174, 96, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #27ae60;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-label {
            font-weight: bold;
            color: #ccc;
        }

        .detail-value {
            color: #fff;
        }

        .debug-info {
            background: rgba(231, 76, 60, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #e74c3c;
            font-size: 0.9em;
        }

        .no-data {
            background: rgba(243, 156, 18, 0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #f39c12;
        }

        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            background: rgba(52, 152, 219, 0.3);
            border: 1px solid #3498db;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: rgba(52, 152, 219, 0.5);
        }

        .filter-btn.active {
            background: #3498db;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .updating {
            animation: pulse 1s infinite;
        }

        .region-group {
            fill: none;
            stroke: #7f8c8d;
            stroke-width: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç –ö–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã - –†–µ–≥–∏–æ–Ω—ã</h1>
            <div class="subtitle">–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è ‚Ä¢ –î–∞–Ω–Ω—ã–µ –∏–∑ Firebase ‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</div>
        </header>

        <div class="content">
            <div class="map-container">
                <div class="filters">
                    <button class="filter-btn active" onclick="setFilter('all')">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</button>
                    <button class="filter-btn" onclick="setFilter('wars')">–¢–æ–ª—å–∫–æ —Å –≤–æ–π–Ω–∞–º–∏</button>
                </div>
                <svg class="europe-map" viewBox="0 0 1200 800" id="europe-map">
                    <!-- –°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω -->
                    <g class="region-group" data-region="scandinavia">
                        <path id="norway" class="region" d="M300,100 L350,120 L340,180 L320,200 L280,180 L290,140 Z" 
                              data-country="norway"/>
                        <path id="sweden" class="region" d="M350,120 L400,130 L420,180 L380,200 L340,180 Z" 
                              data-country="sweden"/>
                        <path id="denmark" class="region" d="M380,200 L400,210 L390,230 L370,220 Z" 
                              data-country="denmark"/>
                        <path id="finland" class="region" d="M420,130 L480,140 L470,200 L420,180 Z" 
                              data-country="finland"/>
                        <text x="370" y="160" class="region-label">–°–∫–∞–Ω–¥–∏–Ω–∞–≤–∏—è</text>
                    </g>

                    <!-- –ë–∞–ª—Ç–∏–π—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω -->
                    <g class="region-group" data-region="baltic">
                        <path id="estonia" class="region" d="M480,180 L520,190 L510,220 L470,210 Z" 
                              data-country="estonia"/>
                        <path id="latvia" class="region" d="M470,210 L510,220 L500,250 L460,240 Z" 
                              data-country="latvia"/>
                        <path id="lithuania" class="region" d="M460,240 L500,250 L490,280 L450,270 Z" 
                              data-country="lithuania"/>
                        <text x="485" y="235" class="region-label">–ë–∞–ª—Ç–∏–∫–∞</text>
                    </g>

                    <!-- –ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–µ –æ—Å—Ç—Ä–æ–≤–∞ -->
                    <g class="region-group" data-region="british_isles">
                        <path id="ireland" class="region" d="M200,250 L250,240 L260,290 L210,300 Z" 
                              data-country="ireland"/>
                        <path id="united_kingdom" class="region" d="M250,240 L300,230 L310,280 L260,290 Z" 
                              data-country="united_kingdom"/>
                        <text x="255" y="270" class="region-label">–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–µ –æ-–≤–∞</text>
                    </g>

                    <!-- –ó–∞–ø–∞–¥–Ω–∞—è –ï–≤—Ä–æ–ø–∞ -->
                    <g class="region-group" data-region="western_europe">
                        <path id="france" class="region" d="M300,300 L370,290 L380,350 L310,360 Z" 
                              data-country="france"/>
                        <path id="belgium" class="region" d="M370,290 L400,285 L405,310 L375,315 Z" 
                              data-country="belgium"/>
                        <path id="netherlands" class="region" d="M400,285 L430,280 L435,305 L405,310 Z" 
                              data-country="netherlands"/>
                        <path id="luxembourg" class="region" d="M375,315 L390,312 L392,325 L377,328 Z" 
                              data-country="luxembourg"/>
                        <text x="350" y="330" class="region-label">–ó–∞–ø–∞–¥–Ω–∞—è –ï–≤—Ä–æ–ø–∞</text>
                    </g>

                    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ï–≤—Ä–æ–ø–∞ -->
                    <g class="region-group" data-region="central_europe">
                        <path id="germany" class="region" d="M400,280 L480,270 L490,330 L410,340 Z" 
                              data-country="germany"/>
                        <path id="austria" class="region" d="M480,270 L520,265 L525,300 L485,305 Z" 
                              data-country="austria"/>
                        <path id="switzerland" class="region" d="M370,340 L390,335 L395,355 L375,360 Z" 
                              data-country="switzerland"/>
                        <path id="czechia" class="region" d="M450,330 L480,325 L485,350 L455,355 Z" 
                              data-country="czechia"/>
                        <text x="445" y="305" class="region-label">–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ï–≤—Ä–æ–ø–∞</text>
                    </g>

                    <!-- –Æ–∂–Ω–∞—è –ï–≤—Ä–æ–ø–∞ -->
                    <g class="region-group" data-region="southern_europe">
                        <path id="italy" class="region" d="M420,380 L470,370 L480,430 L430,440 Z" 
                              data-country="italy"/>
                        <path id="spain" class="region" d="M250,380 L320,370 L330,450 L260,460 Z" 
                              data-country="spain"/>
                        <path id="portugal" class="region" d="M200,380 L250,370 L260,450 L210,460 Z" 
                              data-country="portugal"/>
                        <path id="greece" class="region" d="M580,400 L630,390 L640,450 L590,460 Z" 
                              data-country="greece"/>
                        <text x="340" y="420" class="region-label">–Æ–∂–Ω–∞—è –ï–≤—Ä–æ–ø–∞</text>
                    </g>

                    <!-- –í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞ -->
                    <g class="region-group" data-region="eastern_europe">
                        <path id="poland" class="region" d="M480,270 L550,260 L560,320 L490,330 Z" 
                              data-country="poland"/>
                        <path id="hungary" class="region" d="M520,330 L560,325 L565,360 L525,365 Z" 
                              data-country="hungary"/>
                        <path id="slovakia" class="region" d="M520,300 L540,295 L545,320 L525,325 Z" 
                              data-country="slovakia"/>
                        <path id="romania" class="region" d="M560,325 L600,320 L610,380 L570,385 Z" 
                              data-country="romania"/>
                        <text x="525" y="350" class="region-label">–í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞</text>
                    </g>

                    <!-- –ë–∞–ª–∫–∞–Ω—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω -->
                    <g class="region-group" data-region="balkans">
                        <path id="croatia" class="region" d="M480,360 L520,355 L525,390 L485,395 Z" 
                              data-country="croatia"/>
                        <path id="serbia" class="region" d="M520,355 L550,350 L555,385 L525,390 Z" 
                              data-country="serbia"/>
                        <path id="bulgaria" class="region" d="M560,380 L600,375 L605,420 L565,425 Z" 
                              data-country="bulgaria"/>
                        <path id="albania" class="region" d="M520,390 L540,385 L545,410 L525,415 Z" 
                              data-country="albania"/>
                        <text x="540" y="405" class="region-label">–ë–∞–ª–∫–∞–Ω—ã</text>
                    </g>

                    <!-- –ü–æ–¥–ø–∏—Å–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω -->
                    <text x="325" y="125" class="region-label" font-size="8">NO</text>
                    <text x="375" y="160" class="region-label" font-size="8">SE</text>
                    <text x="385" y="215" class="region-label" font-size="8">DK</text>
                    <text x="450" y="165" class="region-label" font-size="8">FI</text>
                    <text x="495" y="200" class="region-label" font-size="8">EE</text>
                    <text x="485" y="235" class="region-label" font-size="8">LV</text>
                    <text x="475" y="265" class="region-label" font-size="8">LT</text>
                    <text x="225" y="270" class="region-label" font-size="8">IE</text>
                    <text x="275" y="265" class="region-label" font-size="8">UK</text>
                    <text x="335" y="325" class="region-label" font-size="8">FR</text>
                    <text x="385" y="300" class="region-label" font-size="8">BE</text>
                    <text x="415" y="295" class="region-label" font-size="8">NL</text>
                    <text x="383" y="322" class="region-label" font-size="6">LU</text>
                    <text x="440" y="305" class="region-label" font-size="8">DE</text>
                    <text x="500" y="285" class="region-label" font-size="8">AT</text>
                    <text x="380" y="350" class="region-label" font-size="8">CH</text>
                    <text x="465" y="342" class="region-label" font-size="8">CZ</text>
                    <text x="445" y="405" class="region-label" font-size="8">IT</text>
                    <text x="285" y="420" class="region-label" font-size="8">ES</text>
                    <text x="225" y="420" class="region-label" font-size="8">PT</text>
                    <text x="605" y="425" class="region-label" font-size="8">GR</text>
                    <text x="515" y="300" class="region-label" font-size="8">PL</text>
                    <text x="540" y="345" class="region-label" font-size="8">HU</text>
                    <text x="530" y="312" class="region-label" font-size="8">SK</text>
                    <text x="585" y="355" class="region-label" font-size="8">RO</text>
                    <text x="500" y="375" class="region-label" font-size="8">HR</text>
                    <text x="535" y="370" class="region-label" font-size="8">RS</text>
                    <text x="585" y="405" class="region-label" font-size="8">BG</text>
                    <text x="530" y="402" class="region-label" font-size="8">AL</text>
                </svg>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h2>üéØ –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã</h2>
                    <div class="legend">
                        <div class="color-box" style="background-color: #27ae60;"></div>
                        <span>–ú–∏—Ä–Ω—ã–π —Ä–µ–≥–∏–æ–Ω (–¥–æ—Ö–æ–¥ > 0)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #e74c3c;"></div>
                        <span>–†–µ–≥–∏–æ–Ω –≤ –≤–æ–π–Ω–µ</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #3498db;"></div>
                        <span>–í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥ (>100/—á–∞—Å)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #f39c12;"></div>
                        <span>–°–∏–ª—å–Ω–∞—è –∞—Ä–º–∏—è (>1000)</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #9b59b6;"></div>
                        <span>–ú–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤</span>
                    </div>
                    <div class="legend">
                        <div class="color-box" style="background-color: #7f8c8d;"></div>
                        <span>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
                    <div class="status-info">
                        <div class="detail-item">
                            <span class="detail-label">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</span>
                            <span class="detail-value" id="sync-status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–°—Ç—Ä–∞–Ω –∑–∞–≥—Ä—É–∂–µ–Ω–æ:</span>
                            <span class="detail-value" id="countries-count">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–†–µ–≥–∏–æ–Ω–æ–≤:</span>
                            <span class="detail-value" id="regions-count">8</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–π–Ω:</span>
                            <span class="detail-value" id="wars-count">0</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h2>üìç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–≥–∏–æ–Ω–µ</h2>
                    <div class="region-details" id="region-details">
                        <div class="no-data">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –Ω–∞ –∫–∞—Ä—Ç–µ</div>
                    </div>
                </div>

                <div class="control-group">
                    <h2>‚öôÔ∏è –û—Ç–ª–∞–¥–∫–∞</h2>
                    <div class="debug-info" id="debug-info">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDRUoIzXpwwAGYM0qciAYdQm-wtMKqLsVs",
            authDomain: "strani3.firebaseapp.com",
            databaseURL: "https://strani3-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "strani3",
            storageBucket: "strani3.firebasestorage.app",
            messagingSenderId: "225168183800",
            appId: "1:225168183800:web:825e782a35bccca89d460d",
            measurementId: "G-3NKBET5R9J"
        };

        let db;
        let countriesData = {};
        let currentFilter = 'all';
        let selectedRegion = null;

        // –†–µ–≥–∏–æ–Ω—ã –∏ –∏—Ö —Å—Ç—Ä–∞–Ω—ã
        const regions = {
            'scandinavia': ['norway', 'sweden', 'denmark', 'finland'],
            'baltic': ['estonia', 'latvia', 'lithuania'],
            'british_isles': ['ireland', 'united_kingdom'],
            'western_europe': ['france', 'belgium', 'netherlands', 'luxembourg'],
            'central_europe': ['germany', 'austria', 'switzerland', 'czechia'],
            'southern_europe': ['italy', 'spain', 'portugal', 'greece'],
            'eastern_europe': ['poland', 'hungary', 'slovakia', 'romania'],
            'balkans': ['croatia', 'serbia', 'bulgaria', 'albania']
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        function initializeFirebase() {
            try {
                const app = firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                updateDebugInfo("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                return true;
            } catch (error) {
                updateDebugInfo("‚ùå –û—à–∏–±–∫–∞ Firebase: " + error.message);
                return false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateDebugInfo(message) {
            const debugElement = document.getElementById('debug-info');
            debugElement.innerHTML = message;
            console.log(message);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
        function loadCountriesData() {
            if (!db) {
                updateDebugInfo("‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
                return;
            }

            updateDebugInfo("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω...");
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
            db.ref("countries").on("value", (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    countriesData = data;
                    updateDebugInfo(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${Object.keys(data).length} —Å—Ç—Ä–∞–Ω`);
                    updateMapColors();
                    updateStatistics();
                } else {
                    updateDebugInfo("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
                }
            }, (error) => {
                updateDebugInfo("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + error.message);
            });

            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–æ–π–Ω–∞—Ö
            db.ref("wars").on("value", (snapshot) => {
                updateStatistics();
                updateMapColors();
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatistics() {
            const countriesCount = Object.keys(countriesData).length;
            const warsCount = calculateWarsCount();
            
            document.getElementById('countries-count').textContent = countriesCount;
            document.getElementById('wars-count').textContent = warsCount;
            document.getElementById('sync-status').textContent = '‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
            document.getElementById('sync-status').style.color = '#27ae60';
        }

        // –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–π–Ω
        function calculateWarsCount() {
            let wars = 0;
            Object.values(countriesData).forEach(country => {
                if (country.wars && Object.keys(country.wars).length > 0) {
                    wars++;
                }
            });
            return wars;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞
        function getRegionData(regionName) {
            const regionCountries = regions[regionName];
            let totalPopulation = 0;
            let totalArmy = 0;
            let totalGold = 0;
            let hasWars = false;
            let countryCount = 0;

            regionCountries.forEach(countryId => {
                const countryData = countriesData[countryId];
                if (countryData) {
                    totalPopulation += countryData.population || 0;
                    totalArmy += countryData.army || 0;
                    totalGold += countryData.gold || 0;
                    if (countryData.wars && Object.keys(countryData.wars).length > 0) {
                        hasWars = true;
                    }
                    countryCount++;
                }
            });

            return {
                population: totalPopulation,
                army: totalArmy,
                gold: totalGold,
                hasWars: hasWars,
                countryCount: countryCount,
                income: Math.floor(totalPopulation / 100000)
            };
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ä–µ–≥–∏–æ–Ω–∞
        function getRegionColor(regionData) {
            if (regionData.countryCount === 0) return '#7f8c8d'; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
            
            if (regionData.hasWars) return '#e74c3c'; // –í–æ–π–Ω–∞
            
            if (regionData.income > 100) return '#3498db'; // –í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥
            
            if (regionData.army > 1000) return '#f39c12'; // –°–∏–ª—å–Ω–∞—è –∞—Ä–º–∏—è
            
            if (regionData.gold > 5000) return '#9b59b6'; // –ú–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤
            
            return '#27ae60'; // –ú–∏—Ä–Ω—ã–π —Ä–µ–≥–∏–æ–Ω
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
        function updateMapColors() {
            Object.keys(regions).forEach(regionName => {
                const regionData = getRegionData(regionName);
                const color = getRegionColor(regionData);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∫–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∞–º –≤ —Ä–µ–≥–∏–æ–Ω–µ
                regions[regionName].forEach(countryId => {
                    const countryElement = document.getElementById(countryId);
                    if (countryElement) {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
                        if (currentFilter === 'wars' && !regionData.hasWars) {
                            countryElement.style.opacity = '0.3';
                        } else {
                            countryElement.style.opacity = '1';
                        }

                        countryElement.style.fill = color;
                        countryElement.classList.add('updating');
                        
                        setTimeout(() => {
                            countryElement.classList.remove('updating');
                        }, 300);
                    }
                });
            });
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞
        function setFilter(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateMapColors();
        }

        // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–≥–∏–æ–Ω–µ
        function showRegionInfo(regionName) {
            const regionData = getRegionData(regionName);
            const detailsElement = document.getElementById('region-details');
            
            const regionNames = {
                'scandinavia': '–°–∫–∞–Ω–¥–∏–Ω–∞–≤–∏—è',
                'baltic': '–ë–∞–ª—Ç–∏–π—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω',
                'british_isles': '–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–µ –æ—Å—Ç—Ä–æ–≤–∞',
                'western_europe': '–ó–∞–ø–∞–¥–Ω–∞—è –ï–≤—Ä–æ–ø–∞',
                'central_europe': '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ï–≤—Ä–æ–ø–∞',
                'southern_europe': '–Æ–∂–Ω–∞—è –ï–≤—Ä–æ–ø–∞',
                'eastern_europe': '–í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞',
                'balkans': '–ë–∞–ª–∫–∞–Ω—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω'
            };

            if (regionData.countryCount === 0) {
                detailsElement.innerHTML = `
                    <div class="no-data">
                        <h3>${regionNames[regionName]}</h3>
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å—Ç—Ä–∞–Ω–∞–º —Ä–µ–≥–∏–æ–Ω–∞</p>
                    </div>
                `;
                return;
            }

            detailsElement.innerHTML = `
                <h3>${regionNames[regionName]}</h3>
                <div class="detail-item">
                    <span class="detail-label">–°—Ç—Ä–∞–Ω –≤ —Ä–µ–≥–∏–æ–Ω–µ:</span>
                    <span class="detail-value">${regionData.countryCount}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–û–±—â–µ–µ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ:</span>
                    <span class="detail-value">${regionData.population.toLocaleString()}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–û–±—â–∏–π –¥–æ—Ö–æ–¥/—á–∞—Å:</span>
                    <span class="detail-value">${regionData.income} –∑–æ–ª–æ—Ç–∞</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–û–±—â–∞—è –∞—Ä–º–∏—è:</span>
                    <span class="detail-value">${regionData.army} —Å–æ–ª–¥–∞—Ç</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–û–±—â–µ–µ –∑–æ–ª–æ—Ç–æ:</span>
                    <span class="detail-value">${regionData.gold}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="detail-value">${regionData.hasWars ? '‚öîÔ∏è –í–æ–π–Ω–∞' : 'üïäÔ∏è –ú–∏—Ä'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">–°—Ç—Ä–∞–Ω—ã:</span>
                    <span class="detail-value">${regions[regionName].join(', ')}</span>
                </div>
            `;

            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω
            if (selectedRegion) {
                selectedRegion.forEach(countryId => {
                    const element = document.getElementById(countryId);
                    if (element) element.style.strokeWidth = '1';
                });
            }
            
            selectedRegion = regions[regionName];
            selectedRegion.forEach(countryId => {
                const element = document.getElementById(countryId);
                if (element) {
                    element.style.strokeWidth = '3';
                    element.style.stroke = '#f39c12';
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initializeMap() {
            const countries = document.querySelectorAll('.region');
            
            countries.forEach(country => {
                country.addEventListener('click', (e) => {
                    const countryId = e.target.id;
                    // –ù–∞—Ö–æ–¥–∏–º —Ä–µ–≥–∏–æ–Ω –ø–æ —Å—Ç—Ä–∞–Ω–µ
                    for (const [regionName, regionCountries] of Object.entries(regions)) {
                        if (regionCountries.includes(countryId)) {
                            showRegionInfo(regionName);
                            break;
                        }
                    }
                });

                country.addEventListener('mouseenter', (e) => {
                    e.target.style.strokeWidth = '2';
                    e.target.style.stroke = '#3498db';
                });

                country.addEventListener('mouseleave', (e) => {
                    const countryId = e.target.id;
                    let isInSelectedRegion = false;
                    
                    if (selectedRegion) {
                        isInSelectedRegion = selectedRegion.includes(countryId);
                    }
                    
                    if (!isInSelectedRegion) {
                        e.target.style.strokeWidth = '1';
                        e.target.style.stroke = '#fff';
                    }
                });
            });
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initialize() {
            if (initializeFirebase()) {
                loadCountriesData();
                initializeMap();
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                setInterval(() => {
                    updateMapColors();
                    updateStatistics();
                }, 10000);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
